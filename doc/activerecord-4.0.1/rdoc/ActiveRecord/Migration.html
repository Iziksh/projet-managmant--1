<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: ActiveRecord::Migration</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/active_record/migration/command_recorder_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/active_record/migration/command_recorder.rb">lib/active_record/migration/command_recorder.rb</a></li>
          
            <li><a href="../lib/active_record/migration/join_table_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/active_record/migration/join_table.rb">lib/active_record/migration/join_table.rb</a></li>
          
            <li><a href="../lib/active_record/migration_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/active_record/migration.rb">lib/active_record/migration.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link">Object</p>
        
      </div>
      

      

      
      <!-- Namespace Contents -->
      <div id="namespace-list-section" class="section">
        <h3 class="section-header">Namespace</h3>
        <ul class="link-list">
          
          <li><span class="type">CLASS</span> <a href="Migration/CheckPending.html">ActiveRecord::Migration::CheckPending</a></li>
          
          <li><span class="type">CLASS</span> <a href="Migration/CommandRecorder.html">ActiveRecord::Migration::CommandRecorder</a></li>
          
        </ul>
      </div>
      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-check_pending-21">::check_pending!</a></li>
          
          <li><a href="#method-c-disable_ddl_transaction-21">::disable_ddl_transaction!</a></li>
          
          <li><a href="#method-c-migrate">::migrate</a></li>
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-announce">#announce</a></li>
          
          <li><a href="#method-i-connection">#connection</a></li>
          
          <li><a href="#method-i-copy">#copy</a></li>
          
          <li><a href="#method-i-down">#down</a></li>
          
          <li><a href="#method-i-exec_migration">#exec_migration</a></li>
          
          <li><a href="#method-i-method_missing">#method_missing</a></li>
          
          <li><a href="#method-i-migrate">#migrate</a></li>
          
          <li><a href="#method-i-next_migration_number">#next_migration_number</a></li>
          
          <li><a href="#method-i-reversible">#reversible</a></li>
          
          <li><a href="#method-i-revert">#revert</a></li>
          
          <li><a href="#method-i-reverting-3F">#reverting?</a></li>
          
          <li><a href="#method-i-run">#run</a></li>
          
          <li><a href="#method-i-say">#say</a></li>
          
          <li><a href="#method-i-say_with_time">#say_with_time</a></li>
          
          <li><a href="#method-i-suppress_messages">#suppress_messages</a></li>
          
          <li><a href="#method-i-up">#up</a></li>
          
          <li><a href="#method-i-write">#write</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../ActiveRecord.html">ActiveRecord</a></li>
        
          <li><a href="../ActiveRecord/ActiveRecordError.html">ActiveRecord::ActiveRecordError</a></li>
        
          <li><a href="../ActiveRecord/AdapterNotFound.html">ActiveRecord::AdapterNotFound</a></li>
        
          <li><a href="../ActiveRecord/AdapterNotSpecified.html">ActiveRecord::AdapterNotSpecified</a></li>
        
          <li><a href="../ActiveRecord/Aggregations.html">ActiveRecord::Aggregations</a></li>
        
          <li><a href="../ActiveRecord/Aggregations/ClassMethods.html">ActiveRecord::Aggregations::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AssociationRelation.html">ActiveRecord::AssociationRelation</a></li>
        
          <li><a href="../ActiveRecord/AssociationTypeMismatch.html">ActiveRecord::AssociationTypeMismatch</a></li>
        
          <li><a href="../ActiveRecord/Associations.html">ActiveRecord::Associations</a></li>
        
          <li><a href="../ActiveRecord/Associations/ClassMethods.html">ActiveRecord::Associations::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Associations/CollectionProxy.html">ActiveRecord::Associations::CollectionProxy</a></li>
        
          <li><a href="../ActiveRecord/AttributeAssignment.html">ActiveRecord::AttributeAssignment</a></li>
        
          <li><a href="../ActiveRecord/AttributeAssignmentError.html">ActiveRecord::AttributeAssignmentError</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods.html">ActiveRecord::AttributeMethods</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/BeforeTypeCast.html">ActiveRecord::AttributeMethods::BeforeTypeCast</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/ClassMethods.html">ActiveRecord::AttributeMethods::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/PrimaryKey.html">ActiveRecord::AttributeMethods::PrimaryKey</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/PrimaryKey/ClassMethods.html">ActiveRecord::AttributeMethods::PrimaryKey::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Query.html">ActiveRecord::AttributeMethods::Query</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Read.html">ActiveRecord::AttributeMethods::Read</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Read/ClassMethods.html">ActiveRecord::AttributeMethods::Read::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Serialization.html">ActiveRecord::AttributeMethods::Serialization</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Serialization/ClassMethods.html">ActiveRecord::AttributeMethods::Serialization::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/TimeZoneConversion.html">ActiveRecord::AttributeMethods::TimeZoneConversion</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/TimeZoneConversion/ClassMethods.html">ActiveRecord::AttributeMethods::TimeZoneConversion::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Write.html">ActiveRecord::AttributeMethods::Write</a></li>
        
          <li><a href="../ActiveRecord/AttributeMethods/Write/ClassMethods.html">ActiveRecord::AttributeMethods::Write::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/AutosaveAssociation.html">ActiveRecord::AutosaveAssociation</a></li>
        
          <li><a href="../ActiveRecord/AutosaveAssociation/ClassMethods.html">ActiveRecord::AutosaveAssociation::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Base.html">ActiveRecord::Base</a></li>
        
          <li><a href="../ActiveRecord/Batches.html">ActiveRecord::Batches</a></li>
        
          <li><a href="../ActiveRecord/Calculations.html">ActiveRecord::Calculations</a></li>
        
          <li><a href="../ActiveRecord/Callbacks.html">ActiveRecord::Callbacks</a></li>
        
          <li><a href="../ActiveRecord/Callbacks/ClassMethods.html">ActiveRecord::Callbacks::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/ConfigurationError.html">ActiveRecord::ConfigurationError</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters.html">ActiveRecord::ConnectionAdapters</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/AbstractAdapter.html">ActiveRecord::ConnectionAdapters::AbstractAdapter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/AbstractAdapter/SchemaCreation.html">ActiveRecord::ConnectionAdapters::AbstractAdapter::SchemaCreation</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/AbstractMysqlAdapter.html">ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/AbstractMysqlAdapter/SchemaCreation.html">ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter::SchemaCreation</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/ColumnDumper.html">ActiveRecord::ConnectionAdapters::ColumnDumper</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/ConnectionHandler.html">ActiveRecord::ConnectionAdapters::ConnectionHandler</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/ConnectionManagement.html">ActiveRecord::ConnectionAdapters::ConnectionManagement</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/ConnectionPool.html">ActiveRecord::ConnectionAdapters::ConnectionPool</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/ConnectionPool/Queue.html">ActiveRecord::ConnectionAdapters::ConnectionPool::Queue</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/ConnectionPool/Reaper.html">ActiveRecord::ConnectionAdapters::ConnectionPool::Reaper</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/DatabaseLimits.html">ActiveRecord::ConnectionAdapters::DatabaseLimits</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/DatabaseStatements.html">ActiveRecord::ConnectionAdapters::DatabaseStatements</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/Mysql2Adapter.html">ActiveRecord::ConnectionAdapters::Mysql2Adapter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter.html">ActiveRecord::ConnectionAdapters::MysqlAdapter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Boolean.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Boolean</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Date.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Date</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/DateTime.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::DateTime</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Decimal.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Decimal</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Float.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Float</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Identity.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Identity</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Integer.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Integer</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Time.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Time</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Type.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Type</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter/StatementPool.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::StatementPool</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/ColumnDefinition.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::ColumnDefinition</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/ColumnMethods.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::ColumnMethods</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/DatabaseStatements.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::DatabaseStatements</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Array.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Array</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Bit.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Bit</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Boolean.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Boolean</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Bytea.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Bytea</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Cidr.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Cidr</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Date.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Date</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Decimal.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Decimal</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Float.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Float</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Hstore.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Hstore</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Identity.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Identity</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Integer.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Integer</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Json.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Json</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Money.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Money</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Point.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Point</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Range.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Range</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Time.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Time</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Timestamp.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Timestamp</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Type.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Type</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/TypeMap.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::TypeMap</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Vector.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Vector</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/Quoting.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::Quoting</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/ReferentialIntegrity.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::ReferentialIntegrity</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/SchemaCreation.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::SchemaCreation</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/SchemaStatements.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::SchemaStatements</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/StatementPool.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::StatementPool</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/Table.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::Table</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/TableDefinition.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::TableDefinition</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/Utils.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::Utils</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLColumn.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLColumn/ArrayParser.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn::ArrayParser</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLColumn/Cast.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn::Cast</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/QueryCache.html">ActiveRecord::ConnectionAdapters::QueryCache</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/Quoting.html">ActiveRecord::ConnectionAdapters::Quoting</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/SQLite3Adapter.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/SQLite3Adapter/ExplainPrettyPrinter.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter::ExplainPrettyPrinter</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/SQLite3Adapter/StatementPool.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter::StatementPool</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/SQLite3Adapter/Version.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter::Version</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/SchemaCache.html">ActiveRecord::ConnectionAdapters::SchemaCache</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/SchemaStatements.html">ActiveRecord::ConnectionAdapters::SchemaStatements</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/StatementPool.html">ActiveRecord::ConnectionAdapters::StatementPool</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/Table.html">ActiveRecord::ConnectionAdapters::Table</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/TableDefinition.html">ActiveRecord::ConnectionAdapters::TableDefinition</a></li>
        
          <li><a href="../ActiveRecord/ConnectionAdapters/TransactionState.html">ActiveRecord::ConnectionAdapters::TransactionState</a></li>
        
          <li><a href="../ActiveRecord/ConnectionHandling.html">ActiveRecord::ConnectionHandling</a></li>
        
          <li><a href="../ActiveRecord/ConnectionNotEstablished.html">ActiveRecord::ConnectionNotEstablished</a></li>
        
          <li><a href="../ActiveRecord/ConnectionTimeoutError.html">ActiveRecord::ConnectionTimeoutError</a></li>
        
          <li><a href="../ActiveRecord/Core.html">ActiveRecord::Core</a></li>
        
          <li><a href="../ActiveRecord/Core/ClassMethods.html">ActiveRecord::Core::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/CounterCache.html">ActiveRecord::CounterCache</a></li>
        
          <li><a href="../ActiveRecord/CounterCache/ClassMethods.html">ActiveRecord::CounterCache::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/DangerousAttributeError.html">ActiveRecord::DangerousAttributeError</a></li>
        
          <li><a href="../ActiveRecord/DynamicMatchers.html">ActiveRecord::DynamicMatchers</a></li>
        
          <li><a href="../ActiveRecord/DynamicMatchers/FindBy.html">ActiveRecord::DynamicMatchers::FindBy</a></li>
        
          <li><a href="../ActiveRecord/DynamicMatchers/FindByBang.html">ActiveRecord::DynamicMatchers::FindByBang</a></li>
        
          <li><a href="../ActiveRecord/DynamicMatchers/Finder.html">ActiveRecord::DynamicMatchers::Finder</a></li>
        
          <li><a href="../ActiveRecord/DynamicMatchers/Method.html">ActiveRecord::DynamicMatchers::Method</a></li>
        
          <li><a href="../ActiveRecord/Explain.html">ActiveRecord::Explain</a></li>
        
          <li><a href="../ActiveRecord/FinderMethods.html">ActiveRecord::FinderMethods</a></li>
        
          <li><a href="../ActiveRecord/FixtureSet.html">ActiveRecord::FixtureSet</a></li>
        
          <li><a href="../ActiveRecord/ImmutableRelation.html">ActiveRecord::ImmutableRelation</a></li>
        
          <li><a href="../ActiveRecord/Inheritance.html">ActiveRecord::Inheritance</a></li>
        
          <li><a href="../ActiveRecord/Inheritance/ClassMethods.html">ActiveRecord::Inheritance::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Integration.html">ActiveRecord::Integration</a></li>
        
          <li><a href="../ActiveRecord/InvalidForeignKey.html">ActiveRecord::InvalidForeignKey</a></li>
        
          <li><a href="../ActiveRecord/IrreversibleMigration.html">ActiveRecord::IrreversibleMigration</a></li>
        
          <li><a href="../ActiveRecord/Locking.html">ActiveRecord::Locking</a></li>
        
          <li><a href="../ActiveRecord/Locking/Optimistic.html">ActiveRecord::Locking::Optimistic</a></li>
        
          <li><a href="../ActiveRecord/Locking/Optimistic/ClassMethods.html">ActiveRecord::Locking::Optimistic::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Locking/Pessimistic.html">ActiveRecord::Locking::Pessimistic</a></li>
        
          <li><a href="../ActiveRecord/LogSubscriber.html">ActiveRecord::LogSubscriber</a></li>
        
          <li><a href="../ActiveRecord/Migration.html">ActiveRecord::Migration</a></li>
        
          <li><a href="../ActiveRecord/Migration/CheckPending.html">ActiveRecord::Migration::CheckPending</a></li>
        
          <li><a href="../ActiveRecord/Migration/CommandRecorder.html">ActiveRecord::Migration::CommandRecorder</a></li>
        
          <li><a href="../ActiveRecord/Migration/CommandRecorder/StraightReversions.html">ActiveRecord::Migration::CommandRecorder::StraightReversions</a></li>
        
          <li><a href="../ActiveRecord/MigrationProxy.html">ActiveRecord::MigrationProxy</a></li>
        
          <li><a href="../ActiveRecord/ModelSchema.html">ActiveRecord::ModelSchema</a></li>
        
          <li><a href="../ActiveRecord/ModelSchema/ClassMethods.html">ActiveRecord::ModelSchema::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/MultiparameterAssignmentErrors.html">ActiveRecord::MultiparameterAssignmentErrors</a></li>
        
          <li><a href="../ActiveRecord/NestedAttributes.html">ActiveRecord::NestedAttributes</a></li>
        
          <li><a href="../ActiveRecord/NestedAttributes/ClassMethods.html">ActiveRecord::NestedAttributes::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/NestedAttributes/TooManyRecords.html">ActiveRecord::NestedAttributes::TooManyRecords</a></li>
        
          <li><a href="../ActiveRecord/Persistence.html">ActiveRecord::Persistence</a></li>
        
          <li><a href="../ActiveRecord/Persistence/ClassMethods.html">ActiveRecord::Persistence::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/PreparedStatementInvalid.html">ActiveRecord::PreparedStatementInvalid</a></li>
        
          <li><a href="../ActiveRecord/QueryCache.html">ActiveRecord::QueryCache</a></li>
        
          <li><a href="../ActiveRecord/QueryCache/ClassMethods.html">ActiveRecord::QueryCache::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/QueryMethods.html">ActiveRecord::QueryMethods</a></li>
        
          <li><a href="../ActiveRecord/QueryMethods/WhereChain.html">ActiveRecord::QueryMethods::WhereChain</a></li>
        
          <li><a href="../ActiveRecord/Querying.html">ActiveRecord::Querying</a></li>
        
          <li><a href="../ActiveRecord/ReadOnlyRecord.html">ActiveRecord::ReadOnlyRecord</a></li>
        
          <li><a href="../ActiveRecord/ReadonlyAttributes.html">ActiveRecord::ReadonlyAttributes</a></li>
        
          <li><a href="../ActiveRecord/ReadonlyAttributes/ClassMethods.html">ActiveRecord::ReadonlyAttributes::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/RecordInvalid.html">ActiveRecord::RecordInvalid</a></li>
        
          <li><a href="../ActiveRecord/RecordNotDestroyed.html">ActiveRecord::RecordNotDestroyed</a></li>
        
          <li><a href="../ActiveRecord/RecordNotFound.html">ActiveRecord::RecordNotFound</a></li>
        
          <li><a href="../ActiveRecord/RecordNotSaved.html">ActiveRecord::RecordNotSaved</a></li>
        
          <li><a href="../ActiveRecord/RecordNotUnique.html">ActiveRecord::RecordNotUnique</a></li>
        
          <li><a href="../ActiveRecord/Reflection.html">ActiveRecord::Reflection</a></li>
        
          <li><a href="../ActiveRecord/Reflection/ClassMethods.html">ActiveRecord::Reflection::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Reflection/MacroReflection.html">ActiveRecord::Reflection::MacroReflection</a></li>
        
          <li><a href="../ActiveRecord/Relation.html">ActiveRecord::Relation</a></li>
        
          <li><a href="../ActiveRecord/Result.html">ActiveRecord::Result</a></li>
        
          <li><a href="../ActiveRecord/Rollback.html">ActiveRecord::Rollback</a></li>
        
          <li><a href="../ActiveRecord/SQLCounter.html">ActiveRecord::SQLCounter</a></li>
        
          <li><a href="../ActiveRecord/Sanitization.html">ActiveRecord::Sanitization</a></li>
        
          <li><a href="../ActiveRecord/Sanitization/ClassMethods.html">ActiveRecord::Sanitization::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Schema.html">ActiveRecord::Schema</a></li>
        
          <li><a href="../ActiveRecord/SchemaMigration.html">ActiveRecord::SchemaMigration</a></li>
        
          <li><a href="../ActiveRecord/Scoping.html">ActiveRecord::Scoping</a></li>
        
          <li><a href="../ActiveRecord/Scoping/ClassMethods.html">ActiveRecord::Scoping::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Scoping/Default.html">ActiveRecord::Scoping::Default</a></li>
        
          <li><a href="../ActiveRecord/Scoping/Default/ClassMethods.html">ActiveRecord::Scoping::Default::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Scoping/Named.html">ActiveRecord::Scoping::Named</a></li>
        
          <li><a href="../ActiveRecord/Scoping/Named/ClassMethods.html">ActiveRecord::Scoping::Named::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Serialization.html">ActiveRecord::Serialization</a></li>
        
          <li><a href="../ActiveRecord/SerializationTypeMismatch.html">ActiveRecord::SerializationTypeMismatch</a></li>
        
          <li><a href="../ActiveRecord/SpawnMethods.html">ActiveRecord::SpawnMethods</a></li>
        
          <li><a href="../ActiveRecord/StaleObjectError.html">ActiveRecord::StaleObjectError</a></li>
        
          <li><a href="../ActiveRecord/StatementCache.html">ActiveRecord::StatementCache</a></li>
        
          <li><a href="../ActiveRecord/StatementInvalid.html">ActiveRecord::StatementInvalid</a></li>
        
          <li><a href="../ActiveRecord/Store.html">ActiveRecord::Store</a></li>
        
          <li><a href="../ActiveRecord/Store/ClassMethods.html">ActiveRecord::Store::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Tasks.html">ActiveRecord::Tasks</a></li>
        
          <li><a href="../ActiveRecord/Tasks/DatabaseAlreadyExists.html">ActiveRecord::Tasks::DatabaseAlreadyExists</a></li>
        
          <li><a href="../ActiveRecord/Tasks/DatabaseNotSupported.html">ActiveRecord::Tasks::DatabaseNotSupported</a></li>
        
          <li><a href="../ActiveRecord/Tasks/DatabaseTasks.html">ActiveRecord::Tasks::DatabaseTasks</a></li>
        
          <li><a href="../ActiveRecord/TestFixtures.html">ActiveRecord::TestFixtures</a></li>
        
          <li><a href="../ActiveRecord/TestFixtures/ClassMethods.html">ActiveRecord::TestFixtures::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/ThrowResult.html">ActiveRecord::ThrowResult</a></li>
        
          <li><a href="../ActiveRecord/Timestamp.html">ActiveRecord::Timestamp</a></li>
        
          <li><a href="../ActiveRecord/TransactionIsolationError.html">ActiveRecord::TransactionIsolationError</a></li>
        
          <li><a href="../ActiveRecord/Transactions.html">ActiveRecord::Transactions</a></li>
        
          <li><a href="../ActiveRecord/Transactions/ClassMethods.html">ActiveRecord::Transactions::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/Translation.html">ActiveRecord::Translation</a></li>
        
          <li><a href="../ActiveRecord/UnknownAttributeError.html">ActiveRecord::UnknownAttributeError</a></li>
        
          <li><a href="../ActiveRecord/UnknownPrimaryKey.html">ActiveRecord::UnknownPrimaryKey</a></li>
        
          <li><a href="../ActiveRecord/Validations.html">ActiveRecord::Validations</a></li>
        
          <li><a href="../ActiveRecord/Validations/ClassMethods.html">ActiveRecord::Validations::ClassMethods</a></li>
        
          <li><a href="../ActiveRecord/WrappedDatabaseException.html">ActiveRecord::WrappedDatabaseException</a></li>
        
          <li><a href="../Mysql.html">Mysql</a></li>
        
          <li><a href="../Mysql/Result.html">Mysql::Result</a></li>
        
          <li><a href="../Mysql/Stmt.html">Mysql::Stmt</a></li>
        
          <li><a href="../Mysql/Time.html">Mysql::Time</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">ActiveRecord::Migration</h1>

    <div id="description" class="description">
      
<h1>Active Record Migrations</h1>

<p>Migrations can manage the evolution of a schema used by several physical
databases. It’s a solution to the common problem of adding a field to make
a new feature work in your local database, but being unsure of how to push
that change to other developers and to the production server. With
migrations, you can describe the transformations in self-contained classes
that can be checked into version control systems and executed against
another database that might be one, two, or five versions behind.</p>

<p>Example of a simple migration:</p>

<pre>class AddSsl &lt; ActiveRecord::Migration
  def up
    add_column :accounts, :ssl_enabled, :boolean, default: true
  end

  def down
    remove_column :accounts, :ssl_enabled
  end
end</pre>

<p>This migration will add a boolean flag to the accounts table and remove it
if you’re backing out of the migration. It shows how all migrations have
two methods <tt>up</tt> and <tt>down</tt> that describes the
transformations required to implement or remove the migration. These
methods can consist of both the migration specific methods like
<tt>add_column</tt> and <tt>remove_column</tt>, but may also contain
regular Ruby code for generating data needed for the transformations.</p>

<p>Example of a more complex migration that also needs to initialize data:</p>

<pre>class AddSystemSettings &lt; ActiveRecord::Migration
  def up
    create_table :system_settings do |t|
      t.string  :name
      t.string  :label
      t.text    :value
      t.string  :type
      t.integer :position
    end

    SystemSetting.create  name:  'notice',
                          label: 'Use notice?',
                          value: 1
  end

  def down
    drop_table :system_settings
  end
end</pre>

<p>This migration first adds the <tt>system_settings</tt> table, then creates
the very first row in it using the Active Record model that relies on the
table. It also uses the more advanced <tt>create_table</tt> syntax where
you can specify a complete table schema in one block call.</p>

<h2>Available transformations</h2>
<ul><li>
<p><tt>create_table(name, options)</tt>: Creates a table called <tt>name</tt>
and makes the table object available to a block that can then add columns
to it, following the same format as <tt>add_column</tt>. See example above.
The options hash is for fragments like "DEFAULT CHARSET=UTF-8" that are
appended to the create table definition.</p>
</li><li>
<p><tt>drop_table(name)</tt>: Drops the table called <tt>name</tt>.</p>
</li><li>
<p><tt>change_table(name, options)</tt>: Allows to make column alterations to
the table called <tt>name</tt>. It makes the table object available to a
block that can then add/remove columns, indexes or foreign keys to it.</p>
</li><li>
<p><tt>rename_table(old_name, new_name)</tt>: Renames the table called
<tt>old_name</tt> to <tt>new_name</tt>.</p>
</li><li>
<p><tt>add_column(table_name, column_name, type, options)</tt>: Adds a new
column to the table called <tt>table_name</tt> named <tt>column_name</tt>
specified to be one of the following types: <tt>:string</tt>,
<tt>:text</tt>, <tt>:integer</tt>, <tt>:float</tt>, <tt>:decimal</tt>,
<tt>:datetime</tt>, <tt>:timestamp</tt>, <tt>:time</tt>, <tt>:date</tt>,
<tt>:binary</tt>, <tt>:boolean</tt>. A default value can be specified by
passing an <tt>options</tt> hash like <tt>{ default: 11 }</tt>. Other
options include <tt>:limit</tt> and <tt>:null</tt> (e.g. <tt>{ limit: 50,
null: false }</tt>) -- see <a
href="ConnectionAdapters/TableDefinition.html#method-i-column">ActiveRecord::ConnectionAdapters::TableDefinition#column</a>
for details.</p>
</li><li>
<p><tt>rename_column(table_name, column_name, new_column_name)</tt>: Renames a
column but keeps the type and content.</p>
</li><li>
<p><tt>change_column(table_name, column_name, type, options)</tt>:  Changes
the column to a different type using the same parameters as add_column.</p>
</li><li>
<p><tt>remove_column(table_name, column_names)</tt>: Removes the column listed
in <tt>column_names</tt> from the table called <tt>table_name</tt>.</p>
</li><li>
<p><tt>add_index(table_name, column_names, options)</tt>: Adds a new index
with the name of the column. Other options include <tt>:name</tt>,
<tt>:unique</tt> (e.g. <tt>{ name: 'users_name_index', unique: true }</tt>)
and <tt>:order</tt> (e.g. <tt>{ order: { name: :desc } }</tt>).</p>
</li><li>
<p><tt>remove_index(table_name, column: column_name)</tt>: Removes the index
specified by <tt>column_name</tt>.</p>
</li><li>
<p><tt>remove_index(table_name, name: index_name)</tt>: Removes the index
specified by <tt>index_name</tt>.</p>
</li></ul>

<h2>Irreversible transformations</h2>

<p>Some transformations are destructive in a manner that cannot be reversed.
Migrations of that kind should raise an
<tt>ActiveRecord::IrreversibleMigration</tt> exception in their
<tt>down</tt> method.</p>

<h2>Running migrations from within Rails</h2>

<p>The Rails package has several tools to help create and apply migrations.</p>

<p>To generate a new migration, you can use</p>

<pre>rails generate migration MyNewMigration</pre>

<p>where MyNewMigration is the name of your migration. The generator will
create an empty migration file <tt>timestamp_my_new_migration.rb</tt> in
the <tt>db/migrate/</tt> directory where <tt>timestamp</tt> is the UTC
formatted date and time that the migration was generated.</p>

<p>You may then edit the <tt>up</tt> and <tt>down</tt> methods of
MyNewMigration.</p>

<p>There is a special syntactic shortcut to generate migrations that add
fields to a table.</p>

<pre>rails generate migration add_fieldname_to_tablename fieldname:string</pre>

<p>This will generate the file <tt>timestamp_add_fieldname_to_tablename</tt>,
which will look like this:</p>

<pre>class AddFieldnameToTablename &lt; ActiveRecord::Migration
  def up
    add_column :tablenames, :fieldname, :string
  end

  def down
    remove_column :tablenames, :fieldname
  end
end</pre>

<p>To run migrations against the currently configured database, use <tt>rake
db:migrate</tt>. This will update the database by running all of the
pending migrations, creating the <tt>schema_migrations</tt> table (see
“About the schema_migrations table” section below) if missing. It will also
invoke the db:schema:dump task, which will update your db/schema.rb file to
match the structure of your database.</p>

<p>To roll the database back to a previous migration version, use <tt>rake
db:migrate VERSION=X</tt> where <tt>X</tt> is the version to which you wish
to downgrade. If any of the migrations throw an
<tt>ActiveRecord::IrreversibleMigration</tt> exception, that step will fail
and you’ll have some manual work to do.</p>

<h2>Database support</h2>

<p>Migrations are currently supported in MySQL, PostgreSQL, SQLite, SQL
Server, Sybase, and Oracle (all supported databases except DB2).</p>

<h2>More examples</h2>

<p>Not all migrations change the schema. Some just fix the data:</p>

<pre>class RemoveEmptyTags &lt; ActiveRecord::Migration
  def up
    Tag.all.each { |tag| tag.destroy if tag.pages.empty? }
  end

  def down
    # not much we can do to restore deleted data
    raise ActiveRecord::IrreversibleMigration, &quot;Can't recover the deleted tags&quot;
  end
end</pre>

<p>Others remove columns when they migrate up instead of down:</p>

<pre>class RemoveUnnecessaryItemAttributes &lt; ActiveRecord::Migration
  def up
    remove_column :items, :incomplete_items_count
    remove_column :items, :completed_items_count
  end

  def down
    add_column :items, :incomplete_items_count
    add_column :items, :completed_items_count
  end
end</pre>

<p>And sometimes you need to do something in SQL not abstracted directly by
migrations:</p>

<pre>class MakeJoinUnique &lt; ActiveRecord::Migration
  def up
    execute &quot;ALTER TABLE `pages_linked_pages` ADD UNIQUE `page_id_linked_page_id` (`page_id`,`linked_page_id`)&quot;
  end

  def down
    execute &quot;ALTER TABLE `pages_linked_pages` DROP INDEX `page_id_linked_page_id`&quot;
  end
end</pre>

<h2>Using a model after changing its table</h2>

<p>Sometimes you’ll want to add a column in a migration and populate it
immediately after. In that case, you’ll need to make a call to
<tt>Base#reset_column_information</tt> in order to ensure that the model
has the latest column data from after the new column was added. Example:</p>

<pre>class AddPeopleSalary &lt; ActiveRecord::Migration
  def up
    add_column :people, :salary, :integer
    Person.reset_column_information
    Person.all.each do |p|
      p.update_attribute :salary, SalaryCalculator.compute(p)
    end
  end
end</pre>

<h2>Controlling verbosity</h2>

<p>By default, migrations will describe the actions they are taking, writing
them to the console as they happen, along with benchmarks describing how
long each step took.</p>

<p>You can quiet them down by setting ActiveRecord::Migration.verbose = false.</p>

<p>You can also insert your own messages and benchmarks by using the
<tt>say_with_time</tt> method:</p>

<pre>def up
  ...
  say_with_time &quot;Updating salaries...&quot; do
    Person.all.each do |p|
      p.update_attribute :salary, SalaryCalculator.compute(p)
    end
  end
  ...
end</pre>

<p>The phrase “Updating salaries…” would then be printed, along with the
benchmark for the block when the block completes.</p>

<h2>About the schema_migrations table</h2>

<p>Rails versions 2.0 and prior used to create a table called
<tt>schema_info</tt> when using migrations. This table contained the
version of the schema as of the last applied migration.</p>

<p>Starting with Rails 2.1, the <tt>schema_info</tt> table is (automatically)
replaced by the <tt>schema_migrations</tt> table, which contains the
version numbers of all the migrations applied.</p>

<p>As a result, it is now possible to add migration files that are numbered
lower than the current schema version: when migrating up, those
never-applied “interleaved” migrations will be automatically applied, and
when migrating down, never-applied “interleaved” migrations will be
skipped.</p>

<h2>Timestamped Migrations</h2>

<p>By default, Rails generates migrations that look like:</p>

<pre>20080717013526_your_migration_name.rb</pre>

<p>The prefix is a generation timestamp (in UTC).</p>

<p>If you’d prefer to use numeric prefixes, you can turn timestamped
migrations off by setting:</p>

<pre>config.active_record.timestamped_migrations = false</pre>

<p>In application.rb.</p>

<h2>Reversible Migrations</h2>

<p>Starting with Rails 3.1, you will be able to define reversible migrations.
Reversible migrations are migrations that know how to go <tt>down</tt> for
you. You simply supply the <tt>up</tt> logic, and the <a
href="Migration.html">Migration</a> system will figure out how to execute
the down commands for you.</p>

<p>To define a reversible migration, define the <tt>change</tt> method in your
migration like this:</p>

<pre>class TenderloveMigration &lt; ActiveRecord::Migration
  def change
    create_table(:horses) do |t|
      t.column :content, :text
      t.column :remind_at, :datetime
    end
  end
end</pre>

<p>This migration will create the horses table for you on the way up, and
automatically figure out how to drop the table on the way down.</p>

<p>Some commands like <tt>remove_column</tt> cannot be reversed.  If you care
to define how to move up and down in these cases, you should define the
<tt>up</tt> and <tt>down</tt> methods as before.</p>

<p>If a command cannot be reversed, an
<tt>ActiveRecord::IrreversibleMigration</tt> exception will be raised when
the migration is moving down.</p>

<p>For a list of commands that are reversible, please see
<tt>ActiveRecord::Migration::CommandRecorder</tt>.</p>

<h2>Transactional Migrations</h2>

<p>If the database adapter supports DDL transactions, all migrations will
automatically be wrapped in a transaction. There are queries that you can’t
execute inside a transaction though, and for these situations you can turn
the automatic transactions off.</p>

<pre>class ChangeEnum &lt; ActiveRecord::Migration
  disable_ddl_transaction!

  def up
    execute &quot;ALTER TYPE model_size ADD VALUE 'new_value'&quot;
  end
end</pre>

<p>Remember that you can still open your own transactions, even if you are in
a <a href="Migration.html">Migration</a> with
<tt>self.disable_ddl_transaction!</tt>.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="name-attribute-method" class="method-detail">
          <a name="name"></a>
          
          <a name="name="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">name</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="version-attribute-method" class="method-detail">
          <a name="version"></a>
          
          <a name="version="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">version</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="check_pending-21-method" class="method-detail ">
          <a name="method-c-check_pending-21"></a>

          
          <div class="method-heading">
            <span class="method-name">check_pending!</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="check_pending-21-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 378</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">check_pending!</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">PendingMigrationError</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">needs_migration?</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- check_pending-21-source -->
            
          </div>

          

          
        </div><!-- check_pending-21-method -->

      
        <div id="disable_ddl_transaction-21-method" class="method-detail ">
          <a name="method-c-disable_ddl_transaction-21"></a>

          
          <div class="method-heading">
            <span class="method-name">disable_ddl_transaction!</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Disable DDL transactions for this migration.</p>
            

            
            <div class="method-source-code" id="disable_ddl_transaction-21-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 391</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">disable_ddl_transaction!</span>
  <span class="ruby-ivar">@disable_ddl_transaction</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- disable_ddl_transaction-21-source -->
            
          </div>

          

          
        </div><!-- disable_ddl_transaction-21-method -->

      
        <div id="migrate-method" class="method-detail ">
          <a name="method-c-migrate"></a>

          
          <div class="method-heading">
            <span class="method-name">migrate</span><span
              class="method-args">(direction)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="migrate-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 386</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-identifier">direction</span>)
  <span class="ruby-identifier">new</span>.<span class="ruby-identifier">migrate</span> <span class="ruby-identifier">direction</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- migrate-source -->
            
          </div>

          

          
        </div><!-- migrate-method -->

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(name = self.class.name, version = nil)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@name</span>       = <span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@version</span>    = <span class="ruby-identifier">version</span>
  <span class="ruby-ivar">@connection</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="announce-method" class="method-detail ">
          <a name="method-i-announce"></a>

          
          <div class="method-heading">
            <span class="method-name">announce</span><span
              class="method-args">(message)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="announce-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 584</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">announce</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-identifier">text</span> = <span class="ruby-node">&quot;#{version} #{name}: #{message}&quot;</span>
  <span class="ruby-identifier">length</span> = [<span class="ruby-value">0</span>, <span class="ruby-value">75</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">length</span>].<span class="ruby-identifier">max</span>
  <span class="ruby-identifier">write</span> <span class="ruby-string">&quot;== %s %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">text</span>, <span class="ruby-string">&quot;=&quot;</span> * <span class="ruby-identifier">length</span>]
<span class="ruby-keyword">end</span></pre>
            </div><!-- announce-source -->
            
          </div>

          

          
        </div><!-- announce-method -->

      
        <div id="connection-method" class="method-detail ">
          <a name="method-i-connection"></a>

          
          <div class="method-heading">
            <span class="method-name">connection</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="connection-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 610</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">connection</span>
  <span class="ruby-ivar">@connection</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- connection-source -->
            
          </div>

          

          
        </div><!-- connection-method -->

      
        <div id="copy-method" class="method-detail ">
          <a name="method-i-copy"></a>

          
          <div class="method-heading">
            <span class="method-name">copy</span><span
              class="method-args">(destination, sources, options = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="copy-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 629</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">copy</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">sources</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">copied</span> = []

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">destination</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">destination</span>)

  <span class="ruby-identifier">destination_migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrations</span>(<span class="ruby-identifier">destination</span>)
  <span class="ruby-identifier">last</span> = <span class="ruby-identifier">destination_migrations</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">sources</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scope</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">source_migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrations</span>(<span class="ruby-identifier">path</span>)

    <span class="ruby-identifier">source_migrations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">migration</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">source</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span>)
      <span class="ruby-identifier">inserted_comment</span> = <span class="ruby-node">&quot;# This migration comes from #{scope} (originally #{migration.version})\n&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-node">/\A#.*\b(?:en)?coding:\s*\S+/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">source</span>
        <span class="ruby-comment"># If we have a magic comment in the original migration,</span>
        <span class="ruby-comment"># insert our comment after the first newline(end of the magic comment line)</span>
        <span class="ruby-comment"># so the magic keep working.</span>
        <span class="ruby-comment"># Note that magic comments must be at the first line(except sh-bang).</span>
        <span class="ruby-identifier">source</span>[<span class="ruby-regexp">/\n/</span>] = <span class="ruby-node">&quot;\n#{inserted_comment}&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">source</span> = <span class="ruby-node">&quot;#{inserted_comment}#{source}&quot;</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">duplicate</span> = <span class="ruby-identifier">destination_migrations</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">name</span> }
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:on_skip</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">duplicate</span>.<span class="ruby-identifier">scope</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">to_s</span>
          <span class="ruby-identifier">options</span>[<span class="ruby-value">:on_skip</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">migration</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">next_migration_number</span>(<span class="ruby-identifier">last</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">last</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">new_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-node">&quot;#{migration.version}_#{migration.name.underscore}.#{scope}.rb&quot;</span>)
      <span class="ruby-identifier">old_path</span>, <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">new_path</span>
      <span class="ruby-identifier">last</span> = <span class="ruby-identifier">migration</span>

      <span class="ruby-constant">File</span>.<span class="ruby-identifier">binwrite</span>(<span class="ruby-identifier">migration</span>.<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">source</span>)
      <span class="ruby-identifier">copied</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">migration</span>
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:on_copy</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">migration</span>, <span class="ruby-identifier">old_path</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:on_copy</span>]
      <span class="ruby-identifier">destination_migrations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">migration</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">copied</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- copy-source -->
            
          </div>

          

          
        </div><!-- copy-method -->

      
        <div id="down-method" class="method-detail ">
          <a name="method-i-down"></a>

          
          <div class="method-heading">
            <span class="method-name">down</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="down-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 537</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">down</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">delegate</span> = <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:down</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">down</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- down-source -->
            
          </div>

          

          
        </div><!-- down-method -->

      
        <div id="exec_migration-method" class="method-detail ">
          <a name="method-i-exec_migration"></a>

          
          <div class="method-heading">
            <span class="method-name">exec_migration</span><span
              class="method-args">(conn, direction)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="exec_migration-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 565</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">exec_migration</span>(<span class="ruby-identifier">conn</span>, <span class="ruby-identifier">direction</span>)
  <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">conn</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:change</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">direction</span> <span class="ruby-operator">==</span> <span class="ruby-value">:down</span>
      <span class="ruby-identifier">revert</span> { <span class="ruby-identifier">change</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">change</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">send</span>(<span class="ruby-identifier">direction</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@connection</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- exec_migration-source -->
            
          </div>

          

          
        </div><!-- exec_migration-method -->

      
        <div id="method_missing-method" class="method-detail ">
          <a name="method-i-method_missing"></a>

          
          <div class="method-heading">
            <span class="method-name">method_missing</span><span
              class="method-args">(method, *arguments, &block)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="method_missing-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 614</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">method</span>, *<span class="ruby-identifier">arguments</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">arg_list</span> = <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">inspect</span> } * <span class="ruby-string">', '</span>

  <span class="ruby-identifier">say_with_time</span> <span class="ruby-node">&quot;#{method}(#{arg_list})&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:revert</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value">:execute</span>
        <span class="ruby-identifier">arguments</span>[<span class="ruby-value">0</span>] = <span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">first</span>)
        <span class="ruby-identifier">arguments</span>[<span class="ruby-value">1</span>] = <span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">second</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-value">:rename_table</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method</span>, *<span class="ruby-identifier">arguments</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- method_missing-source -->
            
          </div>

          

          
        </div><!-- method_missing-method -->

      
        <div id="migrate-method" class="method-detail ">
          <a name="method-i-migrate"></a>

          
          <div class="method-heading">
            <span class="method-name">migrate</span><span
              class="method-args">(direction)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Execute this migration in the named direction</p>
            

            
            <div class="method-source-code" id="migrate-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 544</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">migrate</span>(<span class="ruby-identifier">direction</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">direction</span>)

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">direction</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:up</span>   <span class="ruby-keyword">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-string">&quot;migrating&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:down</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-string">&quot;reverting&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">time</span>   = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection_pool</span>.<span class="ruby-identifier">with_connection</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">exec_migration</span>(<span class="ruby-identifier">conn</span>, <span class="ruby-identifier">direction</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">direction</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:up</span>   <span class="ruby-keyword">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-string">&quot;migrated (%.4fs)&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>; <span class="ruby-identifier">write</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:down</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">announce</span> <span class="ruby-string">&quot;reverted (%.4fs)&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>; <span class="ruby-identifier">write</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- migrate-source -->
            
          </div>

          

          
        </div><!-- migrate-method -->

      
        <div id="next_migration_number-method" class="method-detail ">
          <a name="method-i-next_migration_number"></a>

          
          <div class="method-heading">
            <span class="method-name">next_migration_number</span><span
              class="method-args">(number)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="next_migration_number-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 674</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_migration_number</span>(<span class="ruby-identifier">number</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">timestamped_migrations</span>
    [<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y%m%d%H%M%S&quot;</span>), <span class="ruby-string">&quot;%.14d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">number</span>].<span class="ruby-identifier">max</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&quot;%.3d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">number</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- next_migration_number-source -->
            
          </div>

          

          
        </div><!-- next_migration_number-method -->

      
        <div id="reversible-method" class="method-detail ">
          <a name="method-i-reversible"></a>

          
          <div class="method-heading">
            <span class="method-name">reversible</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Used to specify an operation that can be run in one direction or another.
Call the methods <tt>up</tt> and <tt>down</tt> of the yielded object to run
a block only in one given direction. The whole block will be called in the
right order within the migration.</p>

<p>In the following example, the looping on users will always be done when the
three columns ‘first_name’, ‘last_name’ and ‘full_name’ exist, even when
migrating down:</p>

<pre>class SplitNameMigration &lt; ActiveRecord::Migration
  def change
    add_column :users, :first_name, :string
    add_column :users, :last_name, :string

    reversible do |dir|
      User.reset_column_information
      User.all.each do |u|
        dir.up   { u.first_name, u.last_name = u.full_name.split(' ') }
        dir.down { u.full_name = &quot;#{u.first_name} #{u.last_name}&quot; }
        u.save
      end
    end

    revert { add_column :users, :full_name, :string }
  end
end</pre>
            

            
            <div class="method-source-code" id="reversible-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reversible</span>
  <span class="ruby-identifier">helper</span> = <span class="ruby-constant">ReversibleBlockHelper</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">reverting?</span>)
  <span class="ruby-identifier">execute_block</span>{ <span class="ruby-keyword">yield</span> <span class="ruby-identifier">helper</span> }
<span class="ruby-keyword">end</span></pre>
            </div><!-- reversible-source -->
            
          </div>

          

          
        </div><!-- reversible-method -->

      
        <div id="revert-method" class="method-detail ">
          <a name="method-i-revert"></a>

          
          <div class="method-heading">
            <span class="method-name">revert</span><span
              class="method-args">(*migration_classes)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Reverses the migration commands for the given block and the given
migrations.</p>

<p>The following migration will remove the table ‘horses’ and create the table
‘apples’ on the way up, and the reverse on the way down.</p>

<pre>class FixTLMigration &lt; ActiveRecord::Migration
  def change
    revert do
      create_table(:horses) do |t|
        t.text :content
        t.datetime :remind_at
      end
    end
    create_table(:apples) do |t|
      t.string :variety
    end
  end
end</pre>

<p>Or equivalently, if <tt>TenderloveMigration</tt> is defined as in the
documentation for Migration:</p>

<pre>require_relative '2012121212_tenderlove_migration'

class FixupTLMigration &lt; ActiveRecord::Migration
  def change
    revert TenderloveMigration

    create_table(:apples) do |t|
      t.string :variety
    end
  end
end</pre>

<p>This command can be nested.</p>
            

            
            <div class="method-source-code" id="revert-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 449</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">revert</span>(*<span class="ruby-identifier">migration_classes</span>)
  <span class="ruby-identifier">run</span>(*<span class="ruby-identifier">migration_classes</span>.<span class="ruby-identifier">reverse</span>, <span class="ruby-identifier">revert</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">migration_classes</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:revert</span>
      <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">revert</span> { <span class="ruby-keyword">yield</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">recorder</span> = <span class="ruby-constant">CommandRecorder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@connection</span>)
      <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">recorder</span>
      <span class="ruby-identifier">suppress_messages</span> <span class="ruby-keyword">do</span>
        <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">revert</span> { <span class="ruby-keyword">yield</span> }
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">recorder</span>.<span class="ruby-identifier">delegate</span>
      <span class="ruby-identifier">recorder</span>.<span class="ruby-identifier">commands</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">send</span>(<span class="ruby-identifier">cmd</span>, *<span class="ruby-identifier">args</span>, &amp;<span class="ruby-identifier">block</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- revert-source -->
            
          </div>

          

          
        </div><!-- revert-method -->

      
        <div id="reverting-3F-method" class="method-detail ">
          <a name="method-i-reverting-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">reverting?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="reverting-3F-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 468</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reverting?</span>
  <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:reverting</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">reverting</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- reverting-3F-source -->
            
          </div>

          

          
        </div><!-- reverting-3F-method -->

      
        <div id="run-method" class="method-detail ">
          <a name="method-i-run"></a>

          
          <div class="method-heading">
            <span class="method-name">run</span><span
              class="method-args">(*migration_classes)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Runs the given migration classes. Last argument can specify options:</p>
<ul><li>
<p>:direction (default is :up)</p>
</li><li>
<p>:revert (default is false)</p>
</li></ul>
            

            
            <div class="method-source-code" id="run-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 517</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(*<span class="ruby-identifier">migration_classes</span>)
  <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">migration_classes</span>.<span class="ruby-identifier">extract_options!</span>
  <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:direction</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:up</span>
  <span class="ruby-identifier">dir</span> = (<span class="ruby-identifier">dir</span> <span class="ruby-operator">==</span> <span class="ruby-value">:down</span> <span class="ruby-operator">?</span> <span class="ruby-value">:up</span> <span class="ruby-operator">:</span> <span class="ruby-value">:down</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:revert</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reverting?</span>
    <span class="ruby-comment"># If in revert and going :up, say, we want to execute :down without reverting, so</span>
    <span class="ruby-identifier">revert</span> { <span class="ruby-identifier">run</span>(*<span class="ruby-identifier">migration_classes</span>, <span class="ruby-identifier">direction</span><span class="ruby-operator">:</span> <span class="ruby-identifier">dir</span>, <span class="ruby-identifier">revert</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">migration_classes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">migration_class</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">migration_class</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">exec_migration</span>(<span class="ruby-ivar">@connection</span>, <span class="ruby-identifier">dir</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- run-source -->
            
          </div>

          

          
        </div><!-- run-method -->

      
        <div id="say-method" class="method-detail ">
          <a name="method-i-say"></a>

          
          <div class="method-heading">
            <span class="method-name">say</span><span
              class="method-args">(message, subitem=false)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="say-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 590</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">say</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">subitem</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">write</span> <span class="ruby-node">&quot;#{subitem ? &quot;   -&gt;&quot; : &quot;--&quot;} #{message}&quot;</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- say-source -->
            
          </div>

          

          
        </div><!-- say-method -->

      
        <div id="say_with_time-method" class="method-detail ">
          <a name="method-i-say_with_time"></a>

          
          <div class="method-heading">
            <span class="method-name">say_with_time</span><span
              class="method-args">(message)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="say_with_time-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 594</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">say_with_time</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-identifier">say</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">time</span> = <span class="ruby-constant">Benchmark</span>.<span class="ruby-identifier">measure</span> { <span class="ruby-identifier">result</span> = <span class="ruby-keyword">yield</span> }
  <span class="ruby-identifier">say</span> <span class="ruby-string">&quot;%.4fs&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">real</span>, <span class="ruby-value">:subitem</span>
  <span class="ruby-identifier">say</span>(<span class="ruby-node">&quot;#{result} rows&quot;</span>, <span class="ruby-value">:subitem</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- say_with_time-source -->
            
          </div>

          

          
        </div><!-- say_with_time-method -->

      
        <div id="suppress_messages-method" class="method-detail ">
          <a name="method-i-suppress_messages"></a>

          
          <div class="method-heading">
            <span class="method-name">suppress_messages</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="suppress_messages-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 603</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">suppress_messages</span>
  <span class="ruby-identifier">save</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-identifier">verbose</span>, <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- suppress_messages-source -->
            
          </div>

          

          
        </div><!-- suppress_messages-method -->

      
        <div id="up-method" class="method-detail ">
          <a name="method-i-up"></a>

          
          <div class="method-heading">
            <span class="method-name">up</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="up-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 531</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">up</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">delegate</span> = <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:up</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">up</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- up-source -->
            
          </div>

          

          
        </div><!-- up-method -->

      
        <div id="write-method" class="method-detail ">
          <a name="method-i-write"></a>

          
          <div class="method-heading">
            <span class="method-name">write</span><span
              class="method-args">(text="")</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="write-source">
<pre>
<span class="ruby-comment"># File lib/active_record/migration.rb, line 580</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">text</span>=<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">puts</span>(<span class="ruby-identifier">text</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- write-source -->
            
          </div>

          

          
        </div><!-- write-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

