<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Module: ActiveRecord::Associations::ClassMethods</title>

  <link rel="stylesheet" href="../../rdoc.css" type="text/css" media="screen" />

  <script src="../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="module">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../lib/active_record/associations_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/active_record/associations.rb">lib/active_record/associations.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-i-belongs_to">#belongs_to</a></li>
          
          <li><a href="#method-i-has_and_belongs_to_many">#has_and_belongs_to_many</a></li>
          
          <li><a href="#method-i-has_many">#has_many</a></li>
          
          <li><a href="#method-i-has_one">#has_one</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../ActiveRecord.html">ActiveRecord</a></li>
        
          <li><a href="../../ActiveRecord/ActiveRecordError.html">ActiveRecord::ActiveRecordError</a></li>
        
          <li><a href="../../ActiveRecord/AdapterNotFound.html">ActiveRecord::AdapterNotFound</a></li>
        
          <li><a href="../../ActiveRecord/AdapterNotSpecified.html">ActiveRecord::AdapterNotSpecified</a></li>
        
          <li><a href="../../ActiveRecord/Aggregations.html">ActiveRecord::Aggregations</a></li>
        
          <li><a href="../../ActiveRecord/Aggregations/ClassMethods.html">ActiveRecord::Aggregations::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AssociationRelation.html">ActiveRecord::AssociationRelation</a></li>
        
          <li><a href="../../ActiveRecord/AssociationTypeMismatch.html">ActiveRecord::AssociationTypeMismatch</a></li>
        
          <li><a href="../../ActiveRecord/Associations.html">ActiveRecord::Associations</a></li>
        
          <li><a href="../../ActiveRecord/Associations/ClassMethods.html">ActiveRecord::Associations::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Associations/CollectionProxy.html">ActiveRecord::Associations::CollectionProxy</a></li>
        
          <li><a href="../../ActiveRecord/AttributeAssignment.html">ActiveRecord::AttributeAssignment</a></li>
        
          <li><a href="../../ActiveRecord/AttributeAssignmentError.html">ActiveRecord::AttributeAssignmentError</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods.html">ActiveRecord::AttributeMethods</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/BeforeTypeCast.html">ActiveRecord::AttributeMethods::BeforeTypeCast</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/ClassMethods.html">ActiveRecord::AttributeMethods::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/PrimaryKey.html">ActiveRecord::AttributeMethods::PrimaryKey</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/PrimaryKey/ClassMethods.html">ActiveRecord::AttributeMethods::PrimaryKey::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Query.html">ActiveRecord::AttributeMethods::Query</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Read.html">ActiveRecord::AttributeMethods::Read</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Read/ClassMethods.html">ActiveRecord::AttributeMethods::Read::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Serialization.html">ActiveRecord::AttributeMethods::Serialization</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Serialization/ClassMethods.html">ActiveRecord::AttributeMethods::Serialization::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/TimeZoneConversion.html">ActiveRecord::AttributeMethods::TimeZoneConversion</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/TimeZoneConversion/ClassMethods.html">ActiveRecord::AttributeMethods::TimeZoneConversion::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Write.html">ActiveRecord::AttributeMethods::Write</a></li>
        
          <li><a href="../../ActiveRecord/AttributeMethods/Write/ClassMethods.html">ActiveRecord::AttributeMethods::Write::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/AutosaveAssociation.html">ActiveRecord::AutosaveAssociation</a></li>
        
          <li><a href="../../ActiveRecord/AutosaveAssociation/ClassMethods.html">ActiveRecord::AutosaveAssociation::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Base.html">ActiveRecord::Base</a></li>
        
          <li><a href="../../ActiveRecord/Batches.html">ActiveRecord::Batches</a></li>
        
          <li><a href="../../ActiveRecord/Calculations.html">ActiveRecord::Calculations</a></li>
        
          <li><a href="../../ActiveRecord/Callbacks.html">ActiveRecord::Callbacks</a></li>
        
          <li><a href="../../ActiveRecord/Callbacks/ClassMethods.html">ActiveRecord::Callbacks::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/ConfigurationError.html">ActiveRecord::ConfigurationError</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters.html">ActiveRecord::ConnectionAdapters</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/AbstractAdapter.html">ActiveRecord::ConnectionAdapters::AbstractAdapter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/AbstractAdapter/SchemaCreation.html">ActiveRecord::ConnectionAdapters::AbstractAdapter::SchemaCreation</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/AbstractMysqlAdapter.html">ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/AbstractMysqlAdapter/SchemaCreation.html">ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter::SchemaCreation</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/ColumnDumper.html">ActiveRecord::ConnectionAdapters::ColumnDumper</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/ConnectionHandler.html">ActiveRecord::ConnectionAdapters::ConnectionHandler</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/ConnectionManagement.html">ActiveRecord::ConnectionAdapters::ConnectionManagement</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/ConnectionPool.html">ActiveRecord::ConnectionAdapters::ConnectionPool</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/ConnectionPool/Queue.html">ActiveRecord::ConnectionAdapters::ConnectionPool::Queue</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/ConnectionPool/Reaper.html">ActiveRecord::ConnectionAdapters::ConnectionPool::Reaper</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/DatabaseLimits.html">ActiveRecord::ConnectionAdapters::DatabaseLimits</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/DatabaseStatements.html">ActiveRecord::ConnectionAdapters::DatabaseStatements</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/Mysql2Adapter.html">ActiveRecord::ConnectionAdapters::Mysql2Adapter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter.html">ActiveRecord::ConnectionAdapters::MysqlAdapter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Boolean.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Boolean</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Date.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Date</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/DateTime.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::DateTime</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Decimal.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Decimal</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Float.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Float</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Identity.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Identity</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Integer.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Integer</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Time.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Time</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/Fields/Type.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::Fields::Type</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/MysqlAdapter/StatementPool.html">ActiveRecord::ConnectionAdapters::MysqlAdapter::StatementPool</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/ColumnDefinition.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::ColumnDefinition</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/ColumnMethods.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::ColumnMethods</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/DatabaseStatements.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::DatabaseStatements</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Array.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Array</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Bit.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Bit</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Boolean.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Boolean</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Bytea.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Bytea</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Cidr.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Cidr</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Date.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Date</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Decimal.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Decimal</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Float.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Float</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Hstore.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Hstore</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Identity.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Identity</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Integer.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Integer</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Json.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Json</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Money.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Money</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Point.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Point</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Range.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Range</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Time.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Time</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Timestamp.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Timestamp</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Type.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Type</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/TypeMap.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::TypeMap</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/OID/Vector.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::OID::Vector</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/Quoting.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::Quoting</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/ReferentialIntegrity.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::ReferentialIntegrity</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/SchemaCreation.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::SchemaCreation</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/SchemaStatements.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::SchemaStatements</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/StatementPool.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::StatementPool</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/Table.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::Table</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/TableDefinition.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::TableDefinition</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter/Utils.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter::Utils</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLColumn.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLColumn/ArrayParser.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn::ArrayParser</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/PostgreSQLColumn/Cast.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn::Cast</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/QueryCache.html">ActiveRecord::ConnectionAdapters::QueryCache</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/Quoting.html">ActiveRecord::ConnectionAdapters::Quoting</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/SQLite3Adapter.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/SQLite3Adapter/ExplainPrettyPrinter.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter::ExplainPrettyPrinter</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/SQLite3Adapter/StatementPool.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter::StatementPool</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/SQLite3Adapter/Version.html">ActiveRecord::ConnectionAdapters::SQLite3Adapter::Version</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/SchemaCache.html">ActiveRecord::ConnectionAdapters::SchemaCache</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/SchemaStatements.html">ActiveRecord::ConnectionAdapters::SchemaStatements</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/StatementPool.html">ActiveRecord::ConnectionAdapters::StatementPool</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/Table.html">ActiveRecord::ConnectionAdapters::Table</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/TableDefinition.html">ActiveRecord::ConnectionAdapters::TableDefinition</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionAdapters/TransactionState.html">ActiveRecord::ConnectionAdapters::TransactionState</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionHandling.html">ActiveRecord::ConnectionHandling</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionNotEstablished.html">ActiveRecord::ConnectionNotEstablished</a></li>
        
          <li><a href="../../ActiveRecord/ConnectionTimeoutError.html">ActiveRecord::ConnectionTimeoutError</a></li>
        
          <li><a href="../../ActiveRecord/Core.html">ActiveRecord::Core</a></li>
        
          <li><a href="../../ActiveRecord/Core/ClassMethods.html">ActiveRecord::Core::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/CounterCache.html">ActiveRecord::CounterCache</a></li>
        
          <li><a href="../../ActiveRecord/CounterCache/ClassMethods.html">ActiveRecord::CounterCache::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/DangerousAttributeError.html">ActiveRecord::DangerousAttributeError</a></li>
        
          <li><a href="../../ActiveRecord/DynamicMatchers.html">ActiveRecord::DynamicMatchers</a></li>
        
          <li><a href="../../ActiveRecord/DynamicMatchers/FindBy.html">ActiveRecord::DynamicMatchers::FindBy</a></li>
        
          <li><a href="../../ActiveRecord/DynamicMatchers/FindByBang.html">ActiveRecord::DynamicMatchers::FindByBang</a></li>
        
          <li><a href="../../ActiveRecord/DynamicMatchers/Finder.html">ActiveRecord::DynamicMatchers::Finder</a></li>
        
          <li><a href="../../ActiveRecord/DynamicMatchers/Method.html">ActiveRecord::DynamicMatchers::Method</a></li>
        
          <li><a href="../../ActiveRecord/Explain.html">ActiveRecord::Explain</a></li>
        
          <li><a href="../../ActiveRecord/FinderMethods.html">ActiveRecord::FinderMethods</a></li>
        
          <li><a href="../../ActiveRecord/FixtureSet.html">ActiveRecord::FixtureSet</a></li>
        
          <li><a href="../../ActiveRecord/ImmutableRelation.html">ActiveRecord::ImmutableRelation</a></li>
        
          <li><a href="../../ActiveRecord/Inheritance.html">ActiveRecord::Inheritance</a></li>
        
          <li><a href="../../ActiveRecord/Inheritance/ClassMethods.html">ActiveRecord::Inheritance::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Integration.html">ActiveRecord::Integration</a></li>
        
          <li><a href="../../ActiveRecord/InvalidForeignKey.html">ActiveRecord::InvalidForeignKey</a></li>
        
          <li><a href="../../ActiveRecord/IrreversibleMigration.html">ActiveRecord::IrreversibleMigration</a></li>
        
          <li><a href="../../ActiveRecord/Locking.html">ActiveRecord::Locking</a></li>
        
          <li><a href="../../ActiveRecord/Locking/Optimistic.html">ActiveRecord::Locking::Optimistic</a></li>
        
          <li><a href="../../ActiveRecord/Locking/Optimistic/ClassMethods.html">ActiveRecord::Locking::Optimistic::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Locking/Pessimistic.html">ActiveRecord::Locking::Pessimistic</a></li>
        
          <li><a href="../../ActiveRecord/LogSubscriber.html">ActiveRecord::LogSubscriber</a></li>
        
          <li><a href="../../ActiveRecord/Migration.html">ActiveRecord::Migration</a></li>
        
          <li><a href="../../ActiveRecord/Migration/CheckPending.html">ActiveRecord::Migration::CheckPending</a></li>
        
          <li><a href="../../ActiveRecord/Migration/CommandRecorder.html">ActiveRecord::Migration::CommandRecorder</a></li>
        
          <li><a href="../../ActiveRecord/Migration/CommandRecorder/StraightReversions.html">ActiveRecord::Migration::CommandRecorder::StraightReversions</a></li>
        
          <li><a href="../../ActiveRecord/MigrationProxy.html">ActiveRecord::MigrationProxy</a></li>
        
          <li><a href="../../ActiveRecord/ModelSchema.html">ActiveRecord::ModelSchema</a></li>
        
          <li><a href="../../ActiveRecord/ModelSchema/ClassMethods.html">ActiveRecord::ModelSchema::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/MultiparameterAssignmentErrors.html">ActiveRecord::MultiparameterAssignmentErrors</a></li>
        
          <li><a href="../../ActiveRecord/NestedAttributes.html">ActiveRecord::NestedAttributes</a></li>
        
          <li><a href="../../ActiveRecord/NestedAttributes/ClassMethods.html">ActiveRecord::NestedAttributes::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/NestedAttributes/TooManyRecords.html">ActiveRecord::NestedAttributes::TooManyRecords</a></li>
        
          <li><a href="../../ActiveRecord/Persistence.html">ActiveRecord::Persistence</a></li>
        
          <li><a href="../../ActiveRecord/Persistence/ClassMethods.html">ActiveRecord::Persistence::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/PreparedStatementInvalid.html">ActiveRecord::PreparedStatementInvalid</a></li>
        
          <li><a href="../../ActiveRecord/QueryCache.html">ActiveRecord::QueryCache</a></li>
        
          <li><a href="../../ActiveRecord/QueryCache/ClassMethods.html">ActiveRecord::QueryCache::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/QueryMethods.html">ActiveRecord::QueryMethods</a></li>
        
          <li><a href="../../ActiveRecord/QueryMethods/WhereChain.html">ActiveRecord::QueryMethods::WhereChain</a></li>
        
          <li><a href="../../ActiveRecord/Querying.html">ActiveRecord::Querying</a></li>
        
          <li><a href="../../ActiveRecord/ReadOnlyRecord.html">ActiveRecord::ReadOnlyRecord</a></li>
        
          <li><a href="../../ActiveRecord/ReadonlyAttributes.html">ActiveRecord::ReadonlyAttributes</a></li>
        
          <li><a href="../../ActiveRecord/ReadonlyAttributes/ClassMethods.html">ActiveRecord::ReadonlyAttributes::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/RecordInvalid.html">ActiveRecord::RecordInvalid</a></li>
        
          <li><a href="../../ActiveRecord/RecordNotDestroyed.html">ActiveRecord::RecordNotDestroyed</a></li>
        
          <li><a href="../../ActiveRecord/RecordNotFound.html">ActiveRecord::RecordNotFound</a></li>
        
          <li><a href="../../ActiveRecord/RecordNotSaved.html">ActiveRecord::RecordNotSaved</a></li>
        
          <li><a href="../../ActiveRecord/RecordNotUnique.html">ActiveRecord::RecordNotUnique</a></li>
        
          <li><a href="../../ActiveRecord/Reflection.html">ActiveRecord::Reflection</a></li>
        
          <li><a href="../../ActiveRecord/Reflection/ClassMethods.html">ActiveRecord::Reflection::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Reflection/MacroReflection.html">ActiveRecord::Reflection::MacroReflection</a></li>
        
          <li><a href="../../ActiveRecord/Relation.html">ActiveRecord::Relation</a></li>
        
          <li><a href="../../ActiveRecord/Result.html">ActiveRecord::Result</a></li>
        
          <li><a href="../../ActiveRecord/Rollback.html">ActiveRecord::Rollback</a></li>
        
          <li><a href="../../ActiveRecord/SQLCounter.html">ActiveRecord::SQLCounter</a></li>
        
          <li><a href="../../ActiveRecord/Sanitization.html">ActiveRecord::Sanitization</a></li>
        
          <li><a href="../../ActiveRecord/Sanitization/ClassMethods.html">ActiveRecord::Sanitization::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Schema.html">ActiveRecord::Schema</a></li>
        
          <li><a href="../../ActiveRecord/SchemaMigration.html">ActiveRecord::SchemaMigration</a></li>
        
          <li><a href="../../ActiveRecord/Scoping.html">ActiveRecord::Scoping</a></li>
        
          <li><a href="../../ActiveRecord/Scoping/ClassMethods.html">ActiveRecord::Scoping::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Scoping/Default.html">ActiveRecord::Scoping::Default</a></li>
        
          <li><a href="../../ActiveRecord/Scoping/Default/ClassMethods.html">ActiveRecord::Scoping::Default::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Scoping/Named.html">ActiveRecord::Scoping::Named</a></li>
        
          <li><a href="../../ActiveRecord/Scoping/Named/ClassMethods.html">ActiveRecord::Scoping::Named::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Serialization.html">ActiveRecord::Serialization</a></li>
        
          <li><a href="../../ActiveRecord/SerializationTypeMismatch.html">ActiveRecord::SerializationTypeMismatch</a></li>
        
          <li><a href="../../ActiveRecord/SpawnMethods.html">ActiveRecord::SpawnMethods</a></li>
        
          <li><a href="../../ActiveRecord/StaleObjectError.html">ActiveRecord::StaleObjectError</a></li>
        
          <li><a href="../../ActiveRecord/StatementCache.html">ActiveRecord::StatementCache</a></li>
        
          <li><a href="../../ActiveRecord/StatementInvalid.html">ActiveRecord::StatementInvalid</a></li>
        
          <li><a href="../../ActiveRecord/Store.html">ActiveRecord::Store</a></li>
        
          <li><a href="../../ActiveRecord/Store/ClassMethods.html">ActiveRecord::Store::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Tasks.html">ActiveRecord::Tasks</a></li>
        
          <li><a href="../../ActiveRecord/Tasks/DatabaseAlreadyExists.html">ActiveRecord::Tasks::DatabaseAlreadyExists</a></li>
        
          <li><a href="../../ActiveRecord/Tasks/DatabaseNotSupported.html">ActiveRecord::Tasks::DatabaseNotSupported</a></li>
        
          <li><a href="../../ActiveRecord/Tasks/DatabaseTasks.html">ActiveRecord::Tasks::DatabaseTasks</a></li>
        
          <li><a href="../../ActiveRecord/TestFixtures.html">ActiveRecord::TestFixtures</a></li>
        
          <li><a href="../../ActiveRecord/TestFixtures/ClassMethods.html">ActiveRecord::TestFixtures::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/ThrowResult.html">ActiveRecord::ThrowResult</a></li>
        
          <li><a href="../../ActiveRecord/Timestamp.html">ActiveRecord::Timestamp</a></li>
        
          <li><a href="../../ActiveRecord/TransactionIsolationError.html">ActiveRecord::TransactionIsolationError</a></li>
        
          <li><a href="../../ActiveRecord/Transactions.html">ActiveRecord::Transactions</a></li>
        
          <li><a href="../../ActiveRecord/Transactions/ClassMethods.html">ActiveRecord::Transactions::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/Translation.html">ActiveRecord::Translation</a></li>
        
          <li><a href="../../ActiveRecord/UnknownAttributeError.html">ActiveRecord::UnknownAttributeError</a></li>
        
          <li><a href="../../ActiveRecord/UnknownPrimaryKey.html">ActiveRecord::UnknownPrimaryKey</a></li>
        
          <li><a href="../../ActiveRecord/Validations.html">ActiveRecord::Validations</a></li>
        
          <li><a href="../../ActiveRecord/Validations/ClassMethods.html">ActiveRecord::Validations::ClassMethods</a></li>
        
          <li><a href="../../ActiveRecord/WrappedDatabaseException.html">ActiveRecord::WrappedDatabaseException</a></li>
        
          <li><a href="../../Mysql.html">Mysql</a></li>
        
          <li><a href="../../Mysql/Result.html">Mysql::Result</a></li>
        
          <li><a href="../../Mysql/Stmt.html">Mysql::Stmt</a></li>
        
          <li><a href="../../Mysql/Time.html">Mysql::Time</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="module">ActiveRecord::Associations::ClassMethods</h1>

    <div id="description" class="description">
      
<p><a href="../Associations.html">Associations</a> are a set of macro-like
class methods for tying objects together through foreign keys. They express
relationships like "Project has one Project Manager" or "Project belongs to
a Portfolio". Each macro adds a number of methods to the class which are
specialized according to the collection or association symbol and the
options hash. It works much the same way as Ruby's own <tt>attr*</tt>
methods.</p>

<pre>class Project &lt; ActiveRecord::Base
  belongs_to              :portfolio
  has_one                 :project_manager
  has_many                :milestones
  has_and_belongs_to_many :categories
end</pre>

<p>The project class now has the following methods (and more) to ease the
traversal and manipulation of its relationships:</p>
<ul><li>
<p><tt>Project#portfolio, Project#portfolio=(portfolio),
Project#portfolio.nil?</tt></p>
</li><li>
<p><tt>Project#project_manager, Project#project_manager=(project_manager),
Project#project_manager.nil?,</tt></p>
</li><li>
<p><tt>Project#milestones.empty?, Project#milestones.size, Project#milestones,
Project#milestones&lt;&lt;(milestone),</tt>
<tt>Project#milestones.delete(milestone),
Project#milestones.destroy(milestone),
Project#milestones.find(milestone_id),</tt> <tt>Project#milestones.build,
Project#milestones.create</tt></p>
</li><li>
<p><tt>Project#categories.empty?, Project#categories.size, Project#categories,
Project#categories&lt;&lt;(category1),</tt>
<tt>Project#categories.delete(category1),
Project#categories.destroy(category1)</tt></p>
</li></ul>

<h3>A word of warning</h3>

<p>Don’t create associations that have the same name as instance methods of
<tt>ActiveRecord::Base</tt>. Since the association adds a method with that
name to its model, it will override the inherited method and break things.
For instance, <tt>attributes</tt> and <tt>connection</tt> would be bad
choices for association names.</p>

<h2>Auto-generated methods</h2>

<h3>Singular associations (one-to-one)</h3>

<pre>                                  |            |  belongs_to  |
generated methods                 | belongs_to | :polymorphic | has_one
----------------------------------+------------+--------------+---------
other                             |     X      |      X       |    X
other=(other)                     |     X      |      X       |    X
build_other(attributes={})        |     X      |              |    X
create_other(attributes={})       |     X      |              |    X
create_other!(attributes={})      |     X      |              |    X</pre>

<h3>Collection associations (one-to-many / many-to-many)</h3>

<pre>                                  |       |          | has_many
generated methods                 | habtm | has_many | :through
----------------------------------+-------+----------+----------
others                            |   X   |    X     |    X
others=(other,other,...)          |   X   |    X     |    X
other_ids                         |   X   |    X     |    X
other_ids=(id,id,...)             |   X   |    X     |    X
others&lt;&lt;                          |   X   |    X     |    X
others.push                       |   X   |    X     |    X
others.concat                     |   X   |    X     |    X
others.build(attributes={})       |   X   |    X     |    X
others.create(attributes={})      |   X   |    X     |    X
others.create!(attributes={})     |   X   |    X     |    X
others.size                       |   X   |    X     |    X
others.length                     |   X   |    X     |    X
others.count                      |   X   |    X     |    X
others.sum(*args)                 |   X   |    X     |    X
others.empty?                     |   X   |    X     |    X
others.clear                      |   X   |    X     |    X
others.delete(other,other,...)    |   X   |    X     |    X
others.delete_all                 |   X   |    X     |    X
others.destroy(other,other,...)   |   X   |    X     |    X
others.destroy_all                |   X   |    X     |    X
others.find(*args)                |   X   |    X     |    X
others.exists?                    |   X   |    X     |    X
others.distinct                   |   X   |    X     |    X
others.uniq                       |   X   |    X     |    X
others.reset                      |   X   |    X     |    X</pre>

<h3>Overriding generated methods</h3>

<p>Association methods are generated in a module that is included into the
model class, which allows you to easily override with your own methods and
call the original generated method with <tt>super</tt>. For example:</p>

<pre>class Car &lt; ActiveRecord::Base
  belongs_to :owner
  belongs_to :old_owner
  def owner=(new_owner)
    self.old_owner = self.owner
    super
  end
end</pre>

<p>If your model class is <tt>Project</tt>, the module is named
<tt>Project::GeneratedFeatureMethods</tt>. The GeneratedFeatureMethods
module is included in the model class immediately after the (anonymous)
generated attributes methods module, meaning an association will override
the methods for an attribute with the same name.</p>

<h2>Cardinality and associations</h2>

<p>Active Record associations can be used to describe one-to-one, one-to-many
and many-to-many relationships between models. Each model uses an
association to describe its role in the relation. The <tt>belongs_to</tt>
association is always used in the model that has the foreign key.</p>

<h3>One-to-one</h3>

<p>Use <tt>has_one</tt> in the base, and <tt>belongs_to</tt> in the associated
model.</p>

<pre>class Employee &lt; ActiveRecord::Base
  has_one :office
end
class Office &lt; ActiveRecord::Base
  belongs_to :employee    # foreign key - employee_id
end</pre>

<h3>One-to-many</h3>

<p>Use <tt>has_many</tt> in the base, and <tt>belongs_to</tt> in the
associated model.</p>

<pre>class Manager &lt; ActiveRecord::Base
  has_many :employees
end
class Employee &lt; ActiveRecord::Base
  belongs_to :manager     # foreign key - manager_id
end</pre>

<h3>Many-to-many</h3>

<p>There are two ways to build a many-to-many relationship.</p>

<p>The first way uses a <tt>has_many</tt> association with the
<tt>:through</tt> option and a join model, so there are two stages of
associations.</p>

<pre>class Assignment &lt; ActiveRecord::Base
  belongs_to :programmer  # foreign key - programmer_id
  belongs_to :project     # foreign key - project_id
end
class Programmer &lt; ActiveRecord::Base
  has_many :assignments
  has_many :projects, through: :assignments
end
class Project &lt; ActiveRecord::Base
  has_many :assignments
  has_many :programmers, through: :assignments
end</pre>

<p>For the second way, use <tt>has_and_belongs_to_many</tt> in both models.
This requires a join table that has no corresponding model or primary key.</p>

<pre>class Programmer &lt; ActiveRecord::Base
  has_and_belongs_to_many :projects       # foreign keys in the join table
end
class Project &lt; ActiveRecord::Base
  has_and_belongs_to_many :programmers    # foreign keys in the join table
end</pre>

<p>Choosing which way to build a many-to-many relationship is not always
simple. If you need to work with the relationship model as its own entity,
use <tt>has_many :through</tt>. Use <tt>has_and_belongs_to_many</tt> when
working with legacy schemas or when you never work directly with the
relationship itself.</p>

<h2>Is it a <tt>belongs_to</tt> or <tt>has_one</tt> association?</h2>

<p>Both express a 1-1 relationship. The difference is mostly where to place
the foreign key, which goes on the table for the class declaring the
<tt>belongs_to</tt> relationship.</p>

<pre>class User &lt; ActiveRecord::Base
  # I reference an account.
  belongs_to :account
end

class Account &lt; ActiveRecord::Base
  # One user references me.
  has_one :user
end</pre>

<p>The tables for these classes could look something like:</p>

<pre>CREATE TABLE users (
  id int(11) NOT NULL auto_increment,
  account_id int(11) default NULL,
  name varchar default NULL,
  PRIMARY KEY  (id)
)

CREATE TABLE accounts (
  id int(11) NOT NULL auto_increment,
  name varchar default NULL,
  PRIMARY KEY  (id)
)</pre>

<h2>Unsaved objects and associations</h2>

<p>You can manipulate objects and associations before they are saved to the
database, but there is some special behavior you should be aware of, mostly
involving the saving of associated objects.</p>

<p>You can set the :autosave option on a <tt>has_one</tt>,
<tt>belongs_to</tt>, <tt>has_many</tt>, or <tt>has_and_belongs_to_many</tt>
association. Setting it to <tt>true</tt> will <em>always</em> save the
members, whereas setting it to <tt>false</tt> will <em>never</em> save the
members. More details about :autosave option is available at
autosave_association.rb .</p>

<h3>One-to-one associations</h3>
<ul><li>
<p>Assigning an object to a <tt>has_one</tt> association automatically saves
that object and the object being replaced (if there is one), in order to
update their foreign keys - except if the parent object is unsaved
(<tt>new_record? == true</tt>).</p>
</li><li>
<p>If either of these saves fail (due to one of the objects being invalid), an
<tt>ActiveRecord::RecordNotSaved</tt> exception is raised and the
assignment is cancelled.</p>
</li><li>
<p>If you wish to assign an object to a <tt>has_one</tt> association without
saving it, use the <tt>build_association</tt> method (documented below).
The object being replaced will still be saved to update its foreign key.</p>
</li><li>
<p>Assigning an object to a <tt>belongs_to</tt> association does not save the
object, since the foreign key field belongs on the parent. It does not save
the parent either.</p>
</li></ul>

<h3>Collections</h3>
<ul><li>
<p>Adding an object to a collection (<tt>has_many</tt> or
<tt>has_and_belongs_to_many</tt>) automatically saves that object, except
if the parent object (the owner of the collection) is not yet stored in the
database.</p>
</li><li>
<p>If saving any of the objects being added to a collection (via <tt>push</tt>
or similar) fails, then <tt>push</tt> returns <tt>false</tt>.</p>
</li><li>
<p>If saving fails while replacing the collection (via <tt>association=</tt>),
an <tt>ActiveRecord::RecordNotSaved</tt> exception is raised and the
assignment is cancelled.</p>
</li><li>
<p>You can add an object to a collection without automatically saving it by
using the <tt>collection.build</tt> method (documented below).</p>
</li><li>
<p>All unsaved (<tt>new_record? == true</tt>) members of the collection are
automatically saved when the parent is saved.</p>
</li></ul>

<h2>Customizing the query</h2>

<p><a href="../Associations.html">Associations</a> are built from
<tt>Relation</tt>s, and you can use the <tt>Relation</tt> syntax to
customize them. For example, to add a condition:</p>

<pre>class Blog &lt; ActiveRecord::Base
  has_many :published_posts, -&gt; { where published: true }, class_name: 'Post'
end</pre>

<p>Inside the <tt>-&gt; { ... }</tt> block you can use all of the usual
<tt>Relation</tt> methods.</p>

<h3>Accessing the owner object</h3>

<p>Sometimes it is useful to have access to the owner object when building the
query. The owner is passed as a parameter to the block. For example, the
following association would find all events that occur on the user’s
birthday:</p>

<pre>class User &lt; ActiveRecord::Base
  has_many :birthday_events, -&gt;(user) { where starts_on: user.birthday }, class_name: 'Event'
end</pre>

<h2>Association callbacks</h2>

<p>Similar to the normal callbacks that hook into the life cycle of an Active
Record object, you can also define callbacks that get triggered when you
add an object to or remove an object from an association collection.</p>

<pre>class Project
  has_and_belongs_to_many :developers, after_add: :evaluate_velocity

  def evaluate_velocity(developer)
    ...
  end
end</pre>

<p>It’s possible to stack callbacks by passing them as an array. Example:</p>

<pre>class Project
  has_and_belongs_to_many :developers,
                          after_add: [:evaluate_velocity, Proc.new { |p, d| p.shipping_date = Time.now}]
end</pre>

<p>Possible callbacks are: <tt>before_add</tt>, <tt>after_add</tt>,
<tt>before_remove</tt> and <tt>after_remove</tt>.</p>

<p>Should any of the <tt>before_add</tt> callbacks throw an exception, the
object does not get added to the collection. Same with the
<tt>before_remove</tt> callbacks; if an exception is thrown the object
doesn’t get removed.</p>

<h2>Association extensions</h2>

<p>The proxy objects that control the access to associations can be extended
through anonymous modules. This is especially beneficial for adding new
finders, creators, and other factory-type methods that are only used as
part of this association.</p>

<pre>class Account &lt; ActiveRecord::Base
  has_many :people do
    def find_or_create_by_name(name)
      first_name, last_name = name.split(&quot; &quot;, 2)
      find_or_create_by(first_name: first_name, last_name: last_name)
    end
  end
end

person = Account.first.people.find_or_create_by_name(&quot;David Heinemeier Hansson&quot;)
person.first_name # =&gt; &quot;David&quot;
person.last_name  # =&gt; &quot;Heinemeier Hansson&quot;</pre>

<p>If you need to share the same extensions between many associations, you can
use a named extension module.</p>

<pre>module FindOrCreateByNameExtension
  def find_or_create_by_name(name)
    first_name, last_name = name.split(&quot; &quot;, 2)
    find_or_create_by(first_name: first_name, last_name: last_name)
  end
end

class Account &lt; ActiveRecord::Base
  has_many :people, -&gt; { extending FindOrCreateByNameExtension }
end

class Company &lt; ActiveRecord::Base
  has_many :people, -&gt; { extending FindOrCreateByNameExtension }
end</pre>

<p>Some extensions can only be made to work with knowledge of the
association’s internals. Extensions can access relevant state using the
following methods (where <tt>items</tt> is the name of the association):</p>
<ul><li>
<p><tt>record.association(:items).owner</tt> - Returns the object the
association is part of.</p>
</li><li>
<p><tt>record.association(:items).reflection</tt> - Returns the reflection
object that describes the association.</p>
</li><li>
<p><tt>record.association(:items).target</tt> - Returns the associated object
for <tt>belongs_to</tt> and <tt>has_one</tt>, or the collection of
associated objects for <tt>has_many</tt> and
<tt>has_and_belongs_to_many</tt>.</p>
</li></ul>

<p>However, inside the actual extension code, you will not have access to the
<tt>record</tt> as above. In this case, you can access
<tt>proxy_association</tt>. For example,
<tt>record.association(:items)</tt> and
<tt>record.items.proxy_association</tt> will return the same object,
allowing you to make calls like <tt>proxy_association.owner</tt> inside
association extensions.</p>

<h2>Association Join Models</h2>

<p>Has Many associations can be configured with the <tt>:through</tt> option
to use an explicit join model to retrieve the data. This operates similarly
to a <tt>has_and_belongs_to_many</tt> association. The advantage is that
you’re able to add validations, callbacks, and extra attributes on the join
model. Consider the following schema:</p>

<pre>class Author &lt; ActiveRecord::Base
  has_many :authorships
  has_many :books, through: :authorships
end

class Authorship &lt; ActiveRecord::Base
  belongs_to :author
  belongs_to :book
end

@author = Author.first
@author.authorships.collect { |a| a.book } # selects all books that the author's authorships belong to
@author.books                              # selects all books by using the Authorship join model</pre>

<p>You can also go through a <tt>has_many</tt> association on the join model:</p>

<pre>class Firm &lt; ActiveRecord::Base
  has_many   :clients
  has_many   :invoices, through: :clients
end

class Client &lt; ActiveRecord::Base
  belongs_to :firm
  has_many   :invoices
end

class Invoice &lt; ActiveRecord::Base
  belongs_to :client
end

@firm = Firm.first
@firm.clients.collect { |c| c.invoices }.flatten # select all invoices for all clients of the firm
@firm.invoices                                   # selects all invoices by going through the Client join model</pre>

<p>Similarly you can go through a <tt>has_one</tt> association on the join
model:</p>

<pre>class Group &lt; ActiveRecord::Base
  has_many   :users
  has_many   :avatars, through: :users
end

class User &lt; ActiveRecord::Base
  belongs_to :group
  has_one    :avatar
end

class Avatar &lt; ActiveRecord::Base
  belongs_to :user
end

@group = Group.first
@group.users.collect { |u| u.avatar }.compact # select all avatars for all users in the group
@group.avatars                                # selects all avatars by going through the User join model.</pre>

<p>An important caveat with going through <tt>has_one</tt> or
<tt>has_many</tt> associations on the join model is that these associations
are <b>read-only</b>. For example, the following would not work following
the previous example:</p>

<pre>@group.avatars &lt;&lt; Avatar.new   # this would work if User belonged_to Avatar rather than the other way around
@group.avatars.delete(@group.avatars.last)  # so would this</pre>

<p>If you are using a <tt>belongs_to</tt> on the join model, it is a good idea
to set the <tt>:inverse_of</tt> option on the <tt>belongs_to</tt>, which
will mean that the following example works correctly (where <tt>tags</tt>
is a <tt>has_many</tt> <tt>:through</tt> association):</p>

<pre>@post = Post.first
@tag = @post.tags.build name: &quot;ruby&quot;
@tag.save</pre>

<p>The last line ought to save the through record (a <tt>Taggable</tt>). This
will only work if the <tt>:inverse_of</tt> is set:</p>

<pre>class Taggable &lt; ActiveRecord::Base
  belongs_to :post
  belongs_to :tag, inverse_of: :taggings
end</pre>

<h2>Nested <a href="../Associations.html">Associations</a></h2>

<p>You can actually specify <b>any</b> association with the <tt>:through</tt>
option, including an association which has a <tt>:through</tt> option
itself. For example:</p>

<pre>class Author &lt; ActiveRecord::Base
  has_many :posts
  has_many :comments, through: :posts
  has_many :commenters, through: :comments
end

class Post &lt; ActiveRecord::Base
  has_many :comments
end

class Comment &lt; ActiveRecord::Base
  belongs_to :commenter
end

@author = Author.first
@author.commenters # =&gt; People who commented on posts written by the author</pre>

<p>An equivalent way of setting up this association this would be:</p>

<pre>class Author &lt; ActiveRecord::Base
  has_many :posts
  has_many :commenters, through: :posts
end

class Post &lt; ActiveRecord::Base
  has_many :comments
  has_many :commenters, through: :comments
end

class Comment &lt; ActiveRecord::Base
  belongs_to :commenter
end</pre>

<p>When using nested association, you will not be able to modify the
association because there is not enough information to know what
modification to make. For example, if you tried to add a <tt>Commenter</tt>
in the example above, there would be no way to tell how to set up the
intermediate <tt>Post</tt> and <tt>Comment</tt> objects.</p>

<h2>Polymorphic <a href="../Associations.html">Associations</a></h2>

<p>Polymorphic associations on models are not restricted on what types of
models they can be associated with. Rather, they specify an interface that
a <tt>has_many</tt> association must adhere to.</p>

<pre>class Asset &lt; ActiveRecord::Base
  belongs_to :attachable, polymorphic: true
end

class Post &lt; ActiveRecord::Base
  has_many :assets, as: :attachable         # The :as option specifies the polymorphic interface to use.
end

@asset.attachable = @post</pre>

<p>This works by using a type column in addition to a foreign key to specify
the associated record. In the Asset example, you’d need an
<tt>attachable_id</tt> integer column and an <tt>attachable_type</tt>
string column.</p>

<p>Using polymorphic associations in combination with single table inheritance
(STI) is a little tricky. In order for the associations to work as
expected, ensure that you store the base model for the STI models in the
type column of the polymorphic association. To continue with the asset
example above, suppose there are guest posts and member posts that use the
posts table for STI. In this case, there must be a <tt>type</tt> column in
the posts table.</p>

<pre>class Asset &lt; ActiveRecord::Base
  belongs_to :attachable, polymorphic: true

  def attachable_type=(sType)
     super(sType.to_s.classify.constantize.base_class.to_s)
  end
end

class Post &lt; ActiveRecord::Base
  # because we store &quot;Post&quot; in attachable_type now dependent: :destroy will work
  has_many :assets, as: :attachable, dependent: :destroy
end

class GuestPost &lt; Post
end

class MemberPost &lt; Post
end</pre>

<h2>Caching</h2>

<p>All of the methods are built on a simple caching principle that will keep
the result of the last query around unless specifically instructed not to.
The cache is even shared across methods to make it even cheaper to use the
macro-added methods without worrying too much about performance at the
first go.</p>

<pre>project.milestones             # fetches milestones from the database
project.milestones.size        # uses the milestone cache
project.milestones.empty?      # uses the milestone cache
project.milestones(true).size  # fetches milestones from the database
project.milestones             # uses the milestone cache</pre>

<h2>Eager loading of associations</h2>

<p>Eager loading is a way to find objects of a certain class and a number of
named associations. This is one of the easiest ways of to prevent the
dreaded 1+N problem in which fetching 100 posts that each need to display
their author triggers 101 database queries. Through the use of eager
loading, the 101 queries can be reduced to 2.</p>

<pre>class Post &lt; ActiveRecord::Base
  belongs_to :author
  has_many   :comments
end</pre>

<p>Consider the following loop using the class above:</p>

<pre>Post.all.each do |post|
  puts &quot;Post:            &quot; + post.title
  puts &quot;Written by:      &quot; + post.author.name
  puts &quot;Last comment on: &quot; + post.comments.first.created_on
end</pre>

<p>To iterate over these one hundred posts, we’ll generate 201 database
queries. Let’s first just optimize it for retrieving the author:</p>

<pre>Post.includes(:author).each do |post|</pre>

<p>This references the name of the <tt>belongs_to</tt> association that also
used the <tt>:author</tt> symbol. After loading the posts, find will
collect the <tt>author_id</tt> from each one and load all the referenced
authors with one query. Doing so will cut down the number of queries from
201 to 102.</p>

<p>We can improve upon the situation further by referencing both associations
in the finder with:</p>

<pre>Post.includes(:author, :comments).each do |post|</pre>

<p>This will load all comments with a single query. This reduces the total
number of queries to 3. More generally the number of queries will be 1 plus
the number of associations named (except if some of the associations are
polymorphic <tt>belongs_to</tt> - see below).</p>

<p>To include a deep hierarchy of associations, use a hash:</p>

<pre>Post.includes(:author, {comments: {author: :gravatar}}).each do |post|</pre>

<p>That’ll grab not only all the comments but all their authors and gravatar
pictures. You can mix and match symbols, arrays and hashes in any
combination to describe the associations you want to load.</p>

<p>All of this power shouldn’t fool you into thinking that you can pull out
huge amounts of data with no performance penalty just because you’ve
reduced the number of queries. The database still needs to send all the
data to Active Record and it still needs to be processed. So it’s no
catch-all for performance problems, but it’s a great way to cut down on the
number of queries in a situation as the one described above.</p>

<p>Since only one table is loaded at a time, conditions or orders cannot
reference tables other than the main one. If this is the case Active Record
falls back to the previously used LEFT OUTER JOIN based strategy. For
example</p>

<pre>Post.includes([:author, :comments]).where(['comments.approved = ?', true])</pre>

<p>This will result in a single SQL query with joins along the lines of:
<tt>LEFT OUTER JOIN comments ON comments.post_id = posts.id</tt> and
<tt>LEFT OUTER JOIN authors ON authors.id = posts.author_id</tt>. Note that
using conditions like this can have unintended consequences. In the above
example posts with no approved comments are not returned at all, because
the conditions apply to the SQL statement as a whole and not just to the
association. You must disambiguate column references for this fallback to
happen, for example <tt>order: &quot;author.name DESC&quot;</tt> will work
but <tt>order: &quot;name DESC&quot;</tt> will not.</p>

<p>If you do want eager load only some members of an association it is usually
more natural to include an association which has conditions defined on it:</p>

<pre>class Post &lt; ActiveRecord::Base
  has_many :approved_comments, -&gt; { where approved: true }, class_name: 'Comment'
end

Post.includes(:approved_comments)</pre>

<p>This will load posts and eager load the <tt>approved_comments</tt>
association, which contains only those comments that have been approved.</p>

<p>If you eager load an association with a specified <tt>:limit</tt> option,
it will be ignored, returning all the associated objects:</p>

<pre>class Picture &lt; ActiveRecord::Base
  has_many :most_recent_comments, -&gt; { order('id DESC').limit(10) }, class_name: 'Comment'
end

Picture.includes(:most_recent_comments).first.most_recent_comments # =&gt; returns all associated comments.</pre>

<p>Eager loading is supported with polymorphic associations.</p>

<pre>class Address &lt; ActiveRecord::Base
  belongs_to :addressable, polymorphic: true
end</pre>

<p>A call that tries to eager load the addressable model</p>

<pre>Address.includes(:addressable)</pre>

<p>This will execute one query to load the addresses and load the addressables
with one query per addressable type. For example if all the addressables
are either of class Person or Company then a total of 3 queries will be
executed. The list of addressable types to load is determined on the back
of the addresses loaded. This is not supported if Active Record has to
fallback to the previous implementation of eager loading and will raise
ActiveRecord::EagerLoadPolymorphicError. The reason is that the parent
model’s type is a column value so its corresponding table name cannot be
put in the <tt>FROM</tt>/<tt>JOIN</tt> clauses of that query.</p>

<h2>Table Aliasing</h2>

<p>Active Record uses table aliasing in the case that a table is referenced
multiple times in a join. If a table is referenced only once, the standard
table name is used. The second time, the table is aliased as
<tt>#{reflection_name}_#{parent_table_name}</tt>. Indexes are appended for
any more successive uses of the table name.</p>

<pre>Post.joins(:comments)
# =&gt; SELECT ... FROM posts INNER JOIN comments ON ...
Post.joins(:special_comments) # STI
# =&gt; SELECT ... FROM posts INNER JOIN comments ON ... AND comments.type = 'SpecialComment'
Post.joins(:comments, :special_comments) # special_comments is the reflection name, posts is the parent table name
# =&gt; SELECT ... FROM posts INNER JOIN comments ON ... INNER JOIN comments special_comments_posts</pre>

<p>Acts as tree example:</p>

<pre>TreeMixin.joins(:children)
# =&gt; SELECT ... FROM mixins INNER JOIN mixins childrens_mixins ...
TreeMixin.joins(children: :parent)
# =&gt; SELECT ... FROM mixins INNER JOIN mixins childrens_mixins ...
                            INNER JOIN parents_mixins ...
TreeMixin.joins(children: {parent: :children})
# =&gt; SELECT ... FROM mixins INNER JOIN mixins childrens_mixins ...
                            INNER JOIN parents_mixins ...
                            INNER JOIN mixins childrens_mixins_2</pre>

<p>Has and Belongs to Many join tables use the same idea, but add a
<tt>_join</tt> suffix:</p>

<pre>Post.joins(:categories)
# =&gt; SELECT ... FROM posts INNER JOIN categories_posts ... INNER JOIN categories ...
Post.joins(categories: :posts)
# =&gt; SELECT ... FROM posts INNER JOIN categories_posts ... INNER JOIN categories ...
                           INNER JOIN categories_posts posts_categories_join INNER JOIN posts posts_categories
Post.joins(categories: {posts: :categories})
# =&gt; SELECT ... FROM posts INNER JOIN categories_posts ... INNER JOIN categories ...
                           INNER JOIN categories_posts posts_categories_join INNER JOIN posts posts_categories
                           INNER JOIN categories_posts categories_posts_join INNER JOIN categories categories_posts_2</pre>

<p>If you wish to specify your own custom joins using <tt>joins</tt> method,
those table names will take precedence over the eager associations:</p>

<pre>Post.joins(:comments).joins(&quot;inner join comments ...&quot;)
# =&gt; SELECT ... FROM posts INNER JOIN comments_posts ON ... INNER JOIN comments ...
Post.joins(:comments, :special_comments).joins(&quot;inner join comments ...&quot;)
# =&gt; SELECT ... FROM posts INNER JOIN comments comments_posts ON ...
                           INNER JOIN comments special_comments_posts ...
                           INNER JOIN comments ...</pre>

<p>Table aliases are automatically truncated according to the maximum length
of table identifiers according to the specific database.</p>

<h2>Modules</h2>

<p>By default, associations will look for objects within the current module
scope. Consider:</p>

<pre>module MyApplication
  module Business
    class Firm &lt; ActiveRecord::Base
      has_many :clients
    end

    class Client &lt; ActiveRecord::Base; end
  end
end</pre>

<p>When <tt>Firm#clients</tt> is called, it will in turn call
<tt>MyApplication::Business::Client.find_all_by_firm_id(firm.id)</tt>. If
you want to associate with a class in another module scope, this can be
done by specifying the complete class name.</p>

<pre>module MyApplication
  module Business
    class Firm &lt; ActiveRecord::Base; end
  end

  module Billing
    class Account &lt; ActiveRecord::Base
      belongs_to :firm, class_name: &quot;MyApplication::Business::Firm&quot;
    end
  end
end</pre>

<h2>Bi-directional associations</h2>

<p>When you specify an association there is usually an association on the
associated model that specifies the same relationship in reverse. For
example, with the following models:</p>

<pre>class Dungeon &lt; ActiveRecord::Base
  has_many :traps
  has_one :evil_wizard
end

class Trap &lt; ActiveRecord::Base
  belongs_to :dungeon
end

class EvilWizard &lt; ActiveRecord::Base
  belongs_to :dungeon
end</pre>

<p>The <tt>traps</tt> association on <tt>Dungeon</tt> and the <tt>dungeon</tt>
association on <tt>Trap</tt> are the inverse of each other and the inverse
of the <tt>dungeon</tt> association on <tt>EvilWizard</tt> is the
<tt>evil_wizard</tt> association on <tt>Dungeon</tt> (and vice-versa). By
default, Active Record doesn’t know anything about these inverse
relationships and so no object loading optimization is possible. For
example:</p>

<pre>d = Dungeon.first
t = d.traps.first
d.level == t.dungeon.level # =&gt; true
d.level = 10
d.level == t.dungeon.level # =&gt; false</pre>

<p>The <tt>Dungeon</tt> instances <tt>d</tt> and <tt>t.dungeon</tt> in the
above example refer to the same object data from the database, but are
actually different in-memory copies of that data. Specifying the
<tt>:inverse_of</tt> option on associations lets you tell Active Record
about inverse relationships and it will optimise object loading. For
example, if we changed our model definitions to:</p>

<pre>class Dungeon &lt; ActiveRecord::Base
  has_many :traps, inverse_of: :dungeon
  has_one :evil_wizard, inverse_of: :dungeon
end

class Trap &lt; ActiveRecord::Base
  belongs_to :dungeon, inverse_of: :traps
end

class EvilWizard &lt; ActiveRecord::Base
  belongs_to :dungeon, inverse_of: :evil_wizard
end</pre>

<p>Then, from our code snippet above, <tt>d</tt> and <tt>t.dungeon</tt> are
actually the same in-memory instance and our final <tt>d.level ==
t.dungeon.level</tt> will return <tt>true</tt>.</p>

<p>There are limitations to <tt>:inverse_of</tt> support:</p>
<ul><li>
<p>does not work with <tt>:through</tt> associations.</p>
</li><li>
<p>does not work with <tt>:polymorphic</tt> associations.</p>
</li><li>
<p>for <tt>belongs_to</tt> associations <tt>has_many</tt> inverse associations
are ignored.</p>
</li></ul>

<h2>Deleting from associations</h2>

<h3>Dependent associations</h3>

<p><tt>has_many</tt>, <tt>has_one</tt> and <tt>belongs_to</tt> associations
support the <tt>:dependent</tt> option. This allows you to specify that
associated records should be deleted when the owner is deleted.</p>

<p>For example:</p>

<pre>class Author
  has_many :posts, dependent: :destroy
end
Author.find(1).destroy # =&gt; Will destroy all of the author's posts, too</pre>

<p>The <tt>:dependent</tt> option can have different values which specify how
the deletion is done. For more information, see the documentation for this
option on the different specific association types. When no option is
given, the behavior is to do nothing with the associated records when
destroying a record.</p>

<p>Note that <tt>:dependent</tt> is implemented using Rails’ callback system,
which works by processing callbacks in order. Therefore, other callbacks
declared either before or after the <tt>:dependent</tt> option can affect
what it does.</p>

<h3>Delete or destroy?</h3>

<p><tt>has_many</tt> and <tt>has_and_belongs_to_many</tt> associations have
the methods <tt>destroy</tt>, <tt>delete</tt>, <tt>destroy_all</tt> and
<tt>delete_all</tt>.</p>

<p>For <tt>has_and_belongs_to_many</tt>, <tt>delete</tt> and <tt>destroy</tt>
are the same: they cause the records in the join table to be removed.</p>

<p>For <tt>has_many</tt>, <tt>destroy</tt> and <tt>destroy_all</tt> will
always call the <tt>destroy</tt> method of the record(s) being removed so
that callbacks are run. However <tt>delete</tt> and <tt>delete_all</tt>
will either do the deletion according to the strategy specified by the
<tt>:dependent</tt> option, or if no <tt>:dependent</tt> option is given,
then it will follow the default strategy. The default strategy is
<tt>:nullify</tt> (set the foreign keys to <tt>nil</tt>), except for
<tt>has_many</tt> <tt>:through</tt>, where the default strategy is
<tt>delete_all</tt> (delete the join records, without running their
callbacks).</p>

<p>There is also a <tt>clear</tt> method which is the same as
<tt>delete_all</tt>, except that it returns the association rather than the
records which have been deleted.</p>

<h3>What gets deleted?</h3>

<p>There is a potential pitfall here: <tt>has_and_belongs_to_many</tt> and
<tt>has_many</tt> <tt>:through</tt> associations have records in join
tables, as well as the associated records. So when we call one of these
deletion methods, what exactly should be deleted?</p>

<p>The answer is that it is assumed that deletion on an association is about
removing the <em>link</em> between the owner and the associated object(s),
rather than necessarily the associated objects themselves. So with
<tt>has_and_belongs_to_many</tt> and <tt>has_many</tt> <tt>:through</tt>,
the join records will be deleted, but the associated records won’t.</p>

<p>This makes sense if you think about it: if you were to call
<tt>post.tags.delete(Tag.find_by(name: 'food'))</tt> you would want the
‘food’ tag to be unlinked from the post, rather than for the tag itself to
be removed from the database.</p>

<p>However, there are examples where this strategy doesn’t make sense. For
example, suppose a person has many projects, and each project has many
tasks. If we deleted one of a person’s tasks, we would probably not want
the project to be deleted. In this scenario, the delete method won’t
actually work: it can only be used if the association on the join model is
a <tt>belongs_to</tt>. In other situations you are expected to perform
operations directly on either the associated records or the
<tt>:through</tt> association.</p>

<p>With a regular <tt>has_many</tt> there is no distinction between the
“associated records” and the “link”, so there is only one choice for what
gets deleted.</p>

<p>With <tt>has_and_belongs_to_many</tt> and <tt>has_many</tt>
<tt>:through</tt>, if you want to delete the associated records themselves,
you can always do something along the lines of
<tt>person.tasks.each(&amp;:destroy)</tt>.</p>

<h2>Type safety with <tt>ActiveRecord::AssociationTypeMismatch</tt></h2>

<p>If you attempt to assign an object to an association that doesn’t match the
inferred or specified <tt>:class_name</tt>, you’ll get an
<tt>ActiveRecord::AssociationTypeMismatch</tt>.</p>

<h2>Options</h2>

<p>All of the association macros can be specialized through options. This
makes cases more complex than the simple and guessable ones possible.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="belongs_to-method" class="method-detail ">
          <a name="method-i-belongs_to"></a>

          
          <div class="method-heading">
            <span class="method-name">belongs_to</span><span
              class="method-args">(name, scope = nil, options = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Specifies a one-to-one association with another class. This method should
only be used if this class contains the foreign key. If the other class
contains the foreign key, then you should use <tt>has_one</tt> instead. See
also ActiveRecord::Associations::ClassMethods’s overview on when to use
<tt>has_one</tt> and when to use <tt>belongs_to</tt>.</p>

<p>Methods will be added for retrieval and query for a single associated
object, for which this object holds an id:</p>
<dl class="rdoc-list"><dt>association(force_reload = false)</dt>
<dd>
<p>Returns the associated object. <tt>nil</tt> is returned if none is found.</p>
</dd><dt>association=(associate)</dt>
<dd>
<p>Assigns the associate object, extracts the primary key, and sets it as the
foreign key.</p>
</dd><dt>build_association(attributes = {})</dt>
<dd>
<p>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt> and linked to this object through a foreign key, but
has not yet been saved.</p>
</dd><dt>create_association(attributes = {})</dt>
<dd>
<p>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt>, linked to this object through a foreign key, and that
has already been saved (if it passed the validation).</p>
</dd><dt>create_association!(attributes = {})</dt>
<dd>
<p>Does the same as <tt>create_association</tt>, but raises
<tt>ActiveRecord::RecordInvalid</tt> if the record is invalid.</p>
</dd></dl>

<p>(<tt>association</tt> is replaced with the symbol passed as the first
argument, so <tt>belongs_to :author</tt> would add among others
<tt>author.nil?</tt>.)</p>

<h3>Example</h3>

<p>A Post class declares <tt>belongs_to :author</tt>, which will add:</p>
<ul><li>
<p><tt>Post#author</tt> (similar to <tt>Author.find(author_id)</tt>)</p>
</li><li>
<p><tt>Post#author=(author)</tt> (similar to <tt>post.author_id =
author.id</tt>)</p>
</li><li>
<p><tt>Post#build_author</tt> (similar to <tt>post.author = Author.new</tt>)</p>
</li><li>
<p><tt>Post#create_author</tt> (similar to <tt>post.author = Author.new;
post.author.save; post.author</tt>)</p>
</li><li>
<p><tt>Post#create_author!</tt> (similar to <tt>post.author = Author.new;
post.author.save!; post.author</tt>)</p>
</li></ul>

<p>The declaration can also include an options hash to specialize the behavior
of the association.</p>

<h3>Options</h3>
<dl class="rdoc-list"><dt>:class_name</dt>
<dd>
<p>Specify the class name of the association. Use it only if that name can’t
be inferred from the association name. So <tt>belongs_to :author</tt> will
by default be linked to the Author class, but if the real class name is
Person, you’ll have to specify it with this option.</p>
</dd><dt>:foreign_key</dt>
<dd>
<p>Specify the foreign key used for the association. By default this is
guessed to be the name of the association with an “_id” suffix. So a class
that defines a <tt>belongs_to :person</tt> association will use “person_id”
as the default <tt>:foreign_key</tt>. Similarly, <tt>belongs_to
:favorite_person, class_name: &quot;Person&quot;</tt> will use a foreign
key of “favorite_person_id”.</p>
</dd><dt>:foreign_type</dt>
<dd>
<p>Specify the column used to store the associated object’s type, if this is a
polymorphic association. By default this is guessed to be the name of the
association with a “_type” suffix. So a class that defines a <tt>belongs_to
:taggable, polymorphic: true</tt> association will use “taggable_type” as
the default <tt>:foreign_type</tt>.</p>
</dd><dt>:primary_key</dt>
<dd>
<p>Specify the method that returns the primary key of associated object used
for the association. By default this is id.</p>
</dd><dt>:dependent</dt>
<dd>
<p>If set to <tt>:destroy</tt>, the associated object is destroyed when this
object is. If set to <tt>:delete</tt>, the associated object is deleted
<b>without</b> calling its destroy method. This option should not be
specified when <tt>belongs_to</tt> is used in conjunction with a
<tt>has_many</tt> relationship on another class because of the potential to
leave orphaned records behind.</p>
</dd><dt>:counter_cache</dt>
<dd>
<p>Caches the number of belonging objects on the associate class through the
use of <tt>increment_counter</tt> and <tt>decrement_counter</tt>. The
counter cache is incremented when an object of this class is created and
decremented when it’s destroyed. This requires that a column named
<tt>#{table_name}_count</tt> (such as <tt>comments_count</tt> for a
belonging Comment class) is used on the associate class (such as a Post
class) - that is the migration for <tt>#{table_name}_count</tt> is created
on the associate class (such that Post.comments_count will return the count
cached, see note below). You can also specify a custom counter cache column
by providing a column name instead of a <tt>true</tt>/<tt>false</tt> value
to this option (e.g., <tt>counter_cache: :my_custom_counter</tt>.) Note:
Specifying a counter cache will add it to that model’s list of readonly
attributes using <tt>attr_readonly</tt>.</p>
</dd><dt>:polymorphic</dt>
<dd>
<p>Specify this association is a polymorphic association by passing
<tt>true</tt>. Note: If you’ve enabled the counter cache, then you may want
to add the counter cache attribute to the <tt>attr_readonly</tt> list in
the associated classes (e.g. <tt>class Post; attr_readonly :comments_count;
end</tt>).</p>
</dd><dt>:validate</dt>
<dd>
<p>If <tt>false</tt>, don’t validate the associated objects when saving the
parent object. <tt>false</tt> by default.</p>
</dd><dt>:autosave</dt>
<dd>
<p>If true, always save the associated object or destroy it if marked for
destruction, when saving the parent object. If false, never save or destroy
the associated object. By default, only save the associated object if it’s
a new record.</p>

<p>Note that <tt>accepts_nested_attributes_for</tt> sets <tt>:autosave</tt> to
<tt>true</tt>.</p>
</dd><dt>:touch</dt>
<dd>
<p>If true, the associated object will be touched (the updated_at/on
attributes set to now) when this record is either saved or destroyed. If
you specify a symbol, that attribute will be updated with the current time
in addition to the updated_at/on attribute.</p>
</dd><dt>:inverse_of</dt>
<dd>
<p>Specifies the name of the <tt>has_one</tt> or <tt>has_many</tt> association
on the associated object that is the inverse of this <tt>belongs_to</tt>
association. Does not work in combination with the <tt>:polymorphic</tt>
options. See ActiveRecord::Associations::ClassMethods’s overview on
Bi-directional associations for more detail.</p>
</dd></dl>

<p>Option examples:</p>

<pre>belongs_to :firm, foreign_key: &quot;client_of&quot;
belongs_to :person, primary_key: &quot;name&quot;, foreign_key: &quot;person_name&quot;
belongs_to :author, class_name: &quot;Person&quot;, foreign_key: &quot;author_id&quot;
belongs_to :valid_coupon, -&gt;(o) { where &quot;discounts &gt; #{o.payments_count}&quot; },
                          class_name: &quot;Coupon&quot;, foreign_key: &quot;coupon_id&quot;
belongs_to :attachable, polymorphic: true
belongs_to :project, readonly: true
belongs_to :post, counter_cache: true
belongs_to :company, touch: true
belongs_to :company, touch: :employees_last_updated_at</pre>
            

            
            <div class="method-source-code" id="belongs_to-source">
<pre>
<span class="ruby-comment"># File lib/active_record/associations.rb, line 1400</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">belongs_to</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">BelongsTo</span>.<span class="ruby-identifier">build</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- belongs_to-source -->
            
          </div>

          

          
        </div><!-- belongs_to-method -->

      
        <div id="has_and_belongs_to_many-method" class="method-detail ">
          <a name="method-i-has_and_belongs_to_many"></a>

          
          <div class="method-heading">
            <span class="method-name">has_and_belongs_to_many</span><span
              class="method-args">(name, scope = nil, options = {}, &extension)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Specifies a many-to-many relationship with another class. This associates
two classes via an intermediate join table. Unless the join table is
explicitly specified as an option, it is guessed using the lexical order of
the class names. So a join between Developer and Project will give the
default join table name of “developers_projects” because “D” precedes “P”
alphabetically. Note that this precedence is calculated using the
<tt>&lt;</tt> operator for String. This means that if the strings are of
different lengths, and the strings are equal when compared up to the
shortest length, then the longer string is considered of higher lexical
precedence than the shorter one. For example, one would expect the tables
“paper_boxes” and “papers” to generate a join table name of
“papers_paper_boxes” because of the length of the name “paper_boxes”, but
it in fact generates a join table name of “paper_boxes_papers”. Be aware of
this caveat, and use the custom <tt>:join_table</tt> option if you need to.
If your tables share a common prefix, it will only appear once at the
beginning. For example, the tables “catalog_categories” and
“catalog_products” generate a join table name of
“catalog_categories_products”.</p>

<p>The join table should not have a primary key or a model associated with it.
You must manually generate the join table with a migration such as this:</p>

<pre>class CreateDevelopersProjectsJoinTable &lt; ActiveRecord::Migration
  def change
    create_table :developers_projects, id: false do |t|
      t.integer :developer_id
      t.integer :project_id
    end
  end
end</pre>

<p>It’s also a good idea to add indexes to each of those columns to speed up
the joins process. However, in MySQL it is advised to add a compound index
for both of the columns as MySQL only uses one index per table during the
lookup.</p>

<p>Adds the following methods for retrieval and query:</p>
<dl class="rdoc-list"><dt>collection(force_reload = false)</dt>
<dd>
<p>Returns an array of all the associated objects. An empty array is returned
if none are found.</p>
</dd><dt>collection&lt;&lt;(object, …)</dt>
<dd>
<p>Adds one or more objects to the collection by creating associations in the
join table (<tt>collection.push</tt> and <tt>collection.concat</tt> are
aliases to this method). Note that this operation instantly fires update
sql without waiting for the save or update call on the parent object,
unless the parent object is a new record.</p>
</dd><dt>collection.delete(object, …)</dt>
<dd>
<p>Removes one or more objects from the collection by removing their
associations from the join table. This does not destroy the objects.</p>
</dd><dt>collection.destroy(object, …)</dt>
<dd>
<p>Removes one or more objects from the collection by running destroy on each
association in the join table, overriding any dependent option. This does
not destroy the objects.</p>
</dd><dt>collection=objects</dt>
<dd>
<p>Replaces the collection’s content by deleting and adding objects as
appropriate.</p>
</dd><dt>collection_singular_ids</dt>
<dd>
<p>Returns an array of the associated objects’ ids.</p>
</dd><dt>collection_singular_ids=ids</dt>
<dd>
<p>Replace the collection by the objects identified by the primary keys in
<tt>ids</tt>.</p>
</dd><dt>collection.clear</dt>
<dd>
<p>Removes every object from the collection. This does not destroy the
objects.</p>
</dd><dt>collection.empty?</dt>
<dd>
<p>Returns <tt>true</tt> if there are no associated objects.</p>
</dd><dt>collection.size</dt>
<dd>
<p>Returns the number of associated objects.</p>
</dd><dt>collection.find(id)</dt>
<dd>
<p>Finds an associated object responding to the <tt>id</tt> and that meets the
condition that it has to be associated with this object. Uses the same
rules as ActiveRecord::Base.find.</p>
</dd><dt>collection.exists?(…)</dt>
<dd>
<p>Checks whether an associated object with the given conditions exists. Uses
the same rules as ActiveRecord::Base.exists?.</p>
</dd><dt>collection.build(attributes = {})</dt>
<dd>
<p>Returns a new object of the collection type that has been instantiated with
<tt>attributes</tt> and linked to this object through the join table, but
has not yet been saved.</p>
</dd><dt>collection.create(attributes = {})</dt>
<dd>
<p>Returns a new object of the collection type that has been instantiated with
<tt>attributes</tt>, linked to this object through the join table, and that
has already been saved (if it passed the validation).</p>
</dd></dl>

<p>(<tt>collection</tt> is replaced with the symbol passed as the first
argument, so <tt>has_and_belongs_to_many :categories</tt> would add among
others <tt>categories.empty?</tt>.)</p>

<h3>Example</h3>

<p>A Developer class declares <tt>has_and_belongs_to_many :projects</tt>,
which will add:</p>
<ul><li>
<p><tt>Developer#projects</tt></p>
</li><li>
<p><tt>Developer#projects&lt;&lt;</tt></p>
</li><li>
<p><tt>Developer#projects.delete</tt></p>
</li><li>
<p><tt>Developer#projects.destroy</tt></p>
</li><li>
<p><tt>Developer#projects=</tt></p>
</li><li>
<p><tt>Developer#project_ids</tt></p>
</li><li>
<p><tt>Developer#project_ids=</tt></p>
</li><li>
<p><tt>Developer#projects.clear</tt></p>
</li><li>
<p><tt>Developer#projects.empty?</tt></p>
</li><li>
<p><tt>Developer#projects.size</tt></p>
</li><li>
<p><tt>Developer#projects.find(id)</tt></p>
</li><li>
<p><tt>Developer#projects.exists?(...)</tt></p>
</li><li>
<p><tt>Developer#projects.build</tt> (similar to
<tt>Project.new(&quot;developer_id&quot; =&gt; id)</tt>)</p>
</li><li>
<p><tt>Developer#projects.create</tt> (similar to <tt>c =
Project.new(&quot;developer_id&quot; =&gt; id); c.save; c</tt>)</p>
</li></ul>

<p>The declaration may include an options hash to specialize the behavior of
the association.</p>

<h3>Options</h3>
<dl class="rdoc-list"><dt>:class_name</dt>
<dd>
<p>Specify the class name of the association. Use it only if that name can’t
be inferred from the association name. So <tt>has_and_belongs_to_many
:projects</tt> will by default be linked to the Project class, but if the
real class name is SuperProject, you’ll have to specify it with this
option.</p>
</dd><dt>:join_table</dt>
<dd>
<p>Specify the name of the join table if the default based on lexical order
isn’t what you want. <b>WARNING:</b> If you’re overwriting the table name
of either class, the <tt>table_name</tt> method MUST be declared underneath
any <tt>has_and_belongs_to_many</tt> declaration in order to work.</p>
</dd><dt>:foreign_key</dt>
<dd>
<p>Specify the foreign key used for the association. By default this is
guessed to be the name of this class in lower-case and “_id” suffixed. So a
Person class that makes a <tt>has_and_belongs_to_many</tt> association to
Project will use “person_id” as the default <tt>:foreign_key</tt>.</p>
</dd><dt>:association_foreign_key</dt>
<dd>
<p>Specify the foreign key used for the association on the receiving side of
the association. By default this is guessed to be the name of the
associated class in lower-case and “_id” suffixed. So if a Person class
makes a <tt>has_and_belongs_to_many</tt> association to Project, the
association will use “project_id” as the default
<tt>:association_foreign_key</tt>.</p>
</dd><dt>:readonly</dt>
<dd>
<p>If true, all the associated objects are readonly through the association.</p>
</dd><dt>:validate</dt>
<dd>
<p>If <tt>false</tt>, don’t validate the associated objects when saving the
parent object. <tt>true</tt> by default.</p>
</dd><dt>:autosave</dt>
<dd>
<p>If true, always save the associated objects or destroy them if marked for
destruction, when saving the parent object. If false, never save or destroy
the associated objects. By default, only save associated objects that are
new records.</p>

<p>Note that <tt>accepts_nested_attributes_for</tt> sets <tt>:autosave</tt> to
<tt>true</tt>.</p>
</dd></dl>

<p>Option examples:</p>

<pre>has_and_belongs_to_many :projects
has_and_belongs_to_many :projects, -&gt; { includes :milestones, :manager }
has_and_belongs_to_many :nations, class_name: &quot;Country&quot;
has_and_belongs_to_many :categories, join_table: &quot;prods_cats&quot;
has_and_belongs_to_many :categories, -&gt; { readonly }</pre>
            

            
            <div class="method-source-code" id="has_and_belongs_to_many-source">
<pre>
<span class="ruby-comment"># File lib/active_record/associations.rb, line 1537</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_and_belongs_to_many</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, &amp;<span class="ruby-identifier">extension</span>)
  <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">HasAndBelongsToMany</span>.<span class="ruby-identifier">build</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">options</span>, &amp;<span class="ruby-identifier">extension</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- has_and_belongs_to_many-source -->
            
          </div>

          

          
        </div><!-- has_and_belongs_to_many-method -->

      
        <div id="has_many-method" class="method-detail ">
          <a name="method-i-has_many"></a>

          
          <div class="method-heading">
            <span class="method-name">has_many</span><span
              class="method-args">(name, scope = nil, options = {}, &extension)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Specifies a one-to-many association. The following methods for retrieval
and query of collections of associated objects will be added:</p>
<dl class="rdoc-list"><dt>collection(force_reload = false)</dt>
<dd>
<p>Returns an array of all the associated objects. An empty array is returned
if none are found.</p>
</dd><dt>collection&lt;&lt;(object, …)</dt>
<dd>
<p>Adds one or more objects to the collection by setting their foreign keys to
the collection’s primary key. Note that this operation instantly fires
update sql without waiting for the save or update call on the parent
object, unless the parent object is a new record.</p>
</dd><dt>collection.delete(object, …)</dt>
<dd>
<p>Removes one or more objects from the collection by setting their foreign
keys to <tt>NULL</tt>. Objects will be in addition destroyed if they’re
associated with <tt>dependent: :destroy</tt>, and deleted if they’re
associated with <tt>dependent: :delete_all</tt>.</p>

<p>If the <tt>:through</tt> option is used, then the join records are deleted
(rather than nullified) by default, but you can specify <tt>dependent:
:destroy</tt> or <tt>dependent: :nullify</tt> to override this.</p>
</dd><dt>collection.destroy(object, …)</dt>
<dd>
<p>Removes one or more objects from the collection by running <tt>destroy</tt>
on each record, regardless of any dependent option, ensuring callbacks are
run.</p>

<p>If the <tt>:through</tt> option is used, then the join records are
destroyed instead, not the objects themselves.</p>
</dd><dt>collection=objects</dt>
<dd>
<p>Replaces the collections content by deleting and adding objects as
appropriate. If the <tt>:through</tt> option is true callbacks in the join
models are triggered except destroy callbacks, since deletion is direct.</p>
</dd><dt>collection_singular_ids</dt>
<dd>
<p>Returns an array of the associated objects’ ids</p>
</dd><dt>collection_singular_ids=ids</dt>
<dd>
<p>Replace the collection with the objects identified by the primary keys in
<tt>ids</tt>. This method loads the models and calls <tt>collection=</tt>.
See above.</p>
</dd><dt>collection.clear</dt>
<dd>
<p>Removes every object from the collection. This destroys the associated
objects if they are associated with <tt>dependent: :destroy</tt>, deletes
them directly from the database if <tt>dependent: :delete_all</tt>,
otherwise sets their foreign keys to <tt>NULL</tt>. If the
<tt>:through</tt> option is true no destroy callbacks are invoked on the
join models. Join models are directly deleted.</p>
</dd><dt>collection.empty?</dt>
<dd>
<p>Returns <tt>true</tt> if there are no associated objects.</p>
</dd><dt>collection.size</dt>
<dd>
<p>Returns the number of associated objects.</p>
</dd><dt>collection.find(…)</dt>
<dd>
<p>Finds an associated object according to the same rules as
ActiveRecord::Base.find.</p>
</dd><dt>collection.exists?(…)</dt>
<dd>
<p>Checks whether an associated object with the given conditions exists. Uses
the same rules as ActiveRecord::Base.exists?.</p>
</dd><dt>collection.build(attributes = {}, …)</dt>
<dd>
<p>Returns one or more new objects of the collection type that have been
instantiated with <tt>attributes</tt> and linked to this object through a
foreign key, but have not yet been saved.</p>
</dd><dt>collection.create(attributes = {})</dt>
<dd>
<p>Returns a new object of the collection type that has been instantiated with
<tt>attributes</tt>, linked to this object through a foreign key, and that
has already been saved (if it passed the validation). <b>Note</b>: This
only works if the base model already exists in the DB, not if it is a new
(unsaved) record!</p>
</dd><dt>collection.create!(attributes = {})</dt>
<dd>
<p>Does the same as <tt>collection.create</tt>, but raises
<tt>ActiveRecord::RecordInvalid</tt> if the record is invalid.</p>
</dd></dl>

<p>(<b>Note</b>: <tt>collection</tt> is replaced with the symbol passed as the
first argument, so <tt>has_many :clients</tt> would add among others
<tt>clients.empty?</tt>.)</p>

<h3>Example</h3>

<p>Example: A Firm class declares <tt>has_many :clients</tt>, which will add:</p>
<ul><li>
<p><tt>Firm#clients</tt> (similar to <tt>Client.where(firm_id: id)</tt>)</p>
</li><li>
<p><tt>Firm#clients&lt;&lt;</tt></p>
</li><li>
<p><tt>Firm#clients.delete</tt></p>
</li><li>
<p><tt>Firm#clients.destroy</tt></p>
</li><li>
<p><tt>Firm#clients=</tt></p>
</li><li>
<p><tt>Firm#client_ids</tt></p>
</li><li>
<p><tt>Firm#client_ids=</tt></p>
</li><li>
<p><tt>Firm#clients.clear</tt></p>
</li><li>
<p><tt>Firm#clients.empty?</tt> (similar to <tt>firm.clients.size == 0</tt>)</p>
</li><li>
<p><tt>Firm#clients.size</tt> (similar to <tt>Client.count &quot;firm_id =
#{id}&quot;</tt>)</p>
</li><li>
<p><tt>Firm#clients.find</tt> (similar to <tt>Client.where(firm_id:
id).find(id)</tt>)</p>
</li><li>
<p><tt>Firm#clients.exists?(name: 'ACME')</tt> (similar to
<tt>Client.exists?(name: 'ACME', firm_id: firm.id)</tt>)</p>
</li><li>
<p><tt>Firm#clients.build</tt> (similar to <tt>Client.new(&quot;firm_id&quot;
=&gt; id)</tt>)</p>
</li><li>
<p><tt>Firm#clients.create</tt> (similar to <tt>c =
Client.new(&quot;firm_id&quot; =&gt; id); c.save; c</tt>)</p>
</li><li>
<p><tt>Firm#clients.create!</tt> (similar to <tt>c =
Client.new(&quot;firm_id&quot; =&gt; id); c.save!</tt>)</p>
</li></ul>

<p>The declaration can also include an options hash to specialize the behavior
of the association.</p>

<h3>Options</h3>
<dl class="rdoc-list"><dt>:class_name</dt>
<dd>
<p>Specify the class name of the association. Use it only if that name can’t
be inferred from the association name. So <tt>has_many :products</tt> will
by default be linked to the Product class, but if the real class name is
SpecialProduct, you’ll have to specify it with this option.</p>
</dd><dt>:foreign_key</dt>
<dd>
<p>Specify the foreign key used for the association. By default this is
guessed to be the name of this class in lower-case and “_id” suffixed. So a
Person class that makes a <tt>has_many</tt> association will use
“person_id” as the default <tt>:foreign_key</tt>.</p>
</dd><dt>:primary_key</dt>
<dd>
<p>Specify the method that returns the primary key used for the association.
By default this is <tt>id</tt>.</p>
</dd><dt>:dependent</dt>
<dd>
<p>Controls what happens to the associated objects when their owner is
destroyed. Note that these are implemented as callbacks, and Rails executes
callbacks in order. Therefore, other similar callbacks may affect the
:dependent behavior, and the :dependent behavior may affect other
callbacks.</p>
<ul><li>
<p><tt>:destroy</tt> causes all the associated objects to also be destroyed.</p>
</li><li>
<p><tt>:delete_all</tt> causes all the associated objects to be deleted
directly from the database (so callbacks will not be executed).</p>
</li><li>
<p><tt>:nullify</tt> causes the foreign keys to be set to <tt>NULL</tt>. <a
href="../Callbacks.html">Callbacks</a> are not executed.</p>
</li><li>
<p><tt>:restrict_with_exception</tt> causes an exception to be raised if there
are any associated records.</p>
</li><li>
<p><tt>:restrict_with_error</tt> causes an error to be added to the owner if
there are any associated objects.</p>
</li></ul>

<p>If using with the <tt>:through</tt> option, the association on the join
model must be a <tt>belongs_to</tt>, and the records which get deleted are
the join records, rather than the associated records.</p>
</dd><dt>:counter_cache</dt>
<dd>
<p>This option can be used to configure a custom named
<tt>:counter_cache.</tt> You only need this option, when you customized the
name of your <tt>:counter_cache</tt> on the <tt>belongs_to</tt>
association.</p>
</dd><dt>:as</dt>
<dd>
<p>Specifies a polymorphic interface (See <tt>belongs_to</tt>).</p>
</dd><dt>:through</dt>
<dd>
<p>Specifies an association through which to perform the query. This can be
any other type of association, including other <tt>:through</tt>
associations. Options for <tt>:class_name</tt>, <tt>:primary_key</tt> and
<tt>:foreign_key</tt> are ignored, as the association uses the source
reflection.</p>

<p>If the association on the join model is a <tt>belongs_to</tt>, the
collection can be modified and the records on the <tt>:through</tt> model
will be automatically created and removed as appropriate. Otherwise, the
collection is read-only, so you should manipulate the <tt>:through</tt>
association directly.</p>

<p>If you are going to modify the association (rather than just read from it),
then it is a good idea to set the <tt>:inverse_of</tt> option on the source
association on the join model. This allows associated records to be built
which will automatically create the appropriate join model records when
they are saved. (See the ‘Association Join Models’ section above.)</p>
</dd><dt>:source</dt>
<dd>
<p>Specifies the source association name used by <tt>has_many :through</tt>
queries. Only use it if the name cannot be inferred from the association.
<tt>has_many :subscribers, through: :subscriptions</tt> will look for
either <tt>:subscribers</tt> or <tt>:subscriber</tt> on Subscription,
unless a <tt>:source</tt> is given.</p>
</dd><dt>:source_type</dt>
<dd>
<p>Specifies type of the source association used by <tt>has_many :through</tt>
queries where the source association is a polymorphic <tt>belongs_to</tt>.</p>
</dd><dt>:validate</dt>
<dd>
<p>If <tt>false</tt>, don’t validate the associated objects when saving the
parent object. true by default.</p>
</dd><dt>:autosave</dt>
<dd>
<p>If true, always save the associated objects or destroy them if marked for
destruction, when saving the parent object. If false, never save or destroy
the associated objects. By default, only save associated objects that are
new records. This option is implemented as a before_save callback. Because
callbacks are run in the order they are defined, associated objects may
need to be explicitly saved in any user-defined before_save callbacks.</p>

<p>Note that <tt>accepts_nested_attributes_for</tt> sets <tt>:autosave</tt> to
<tt>true</tt>.</p>
</dd><dt>:inverse_of</dt>
<dd>
<p>Specifies the name of the <tt>belongs_to</tt> association on the associated
object that is the inverse of this <tt>has_many</tt> association. Does not
work in combination with <tt>:through</tt> or <tt>:as</tt> options. See
ActiveRecord::Associations::ClassMethods’s overview on Bi-directional
associations for more detail.</p>
</dd></dl>

<p>Option examples:</p>

<pre>has_many :comments, -&gt; { order &quot;posted_on&quot; }
has_many :comments, -&gt; { includes :author }
has_many :people, -&gt; { where(&quot;deleted = 0&quot;).order(&quot;name&quot;) }, class_name: &quot;Person&quot;
has_many :tracks, -&gt; { order &quot;position&quot; }, dependent: :destroy
has_many :comments, dependent: :nullify
has_many :tags, as: :taggable
has_many :reports, -&gt; { readonly }
has_many :subscribers, through: :subscriptions, source: :user</pre>
            

            
            <div class="method-source-code" id="has_many-source">
<pre>
<span class="ruby-comment"># File lib/active_record/associations.rb, line 1185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_many</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, &amp;<span class="ruby-identifier">extension</span>)
  <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">HasMany</span>.<span class="ruby-identifier">build</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">options</span>, &amp;<span class="ruby-identifier">extension</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- has_many-source -->
            
          </div>

          

          
        </div><!-- has_many-method -->

      
        <div id="has_one-method" class="method-detail ">
          <a name="method-i-has_one"></a>

          
          <div class="method-heading">
            <span class="method-name">has_one</span><span
              class="method-args">(name, scope = nil, options = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Specifies a one-to-one association with another class. This method should
only be used if the other class contains the foreign key. If the current
class contains the foreign key, then you should use <tt>belongs_to</tt>
instead. See also ActiveRecord::Associations::ClassMethods’s overview on
when to use <a href="ClassMethods.html#method-i-has_one">has_one</a> and
when to use belongs_to.</p>

<p>The following methods for retrieval and query of a single associated object
will be added:</p>
<dl class="rdoc-list"><dt>association(force_reload = false)</dt>
<dd>
<p>Returns the associated object. <tt>nil</tt> is returned if none is found.</p>
</dd><dt>association=(associate)</dt>
<dd>
<p>Assigns the associate object, extracts the primary key, sets it as the
foreign key, and saves the associate object.</p>
</dd><dt>build_association(attributes = {})</dt>
<dd>
<p>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt> and linked to this object through a foreign key, but
has not yet been saved.</p>
</dd><dt>create_association(attributes = {})</dt>
<dd>
<p>Returns a new object of the associated type that has been instantiated with
<tt>attributes</tt>, linked to this object through a foreign key, and that
has already been saved (if it passed the validation).</p>
</dd><dt>create_association!(attributes = {})</dt>
<dd>
<p>Does the same as <tt>create_association</tt>, but raises
<tt>ActiveRecord::RecordInvalid</tt> if the record is invalid.</p>
</dd></dl>

<p>(<tt>association</tt> is replaced with the symbol passed as the first
argument, so <tt>has_one :manager</tt> would add among others
<tt>manager.nil?</tt>.)</p>

<h3>Example</h3>

<p>An Account class declares <tt>has_one :beneficiary</tt>, which will add:</p>
<ul><li>
<p><tt>Account#beneficiary</tt> (similar to <tt>Beneficiary.where(account_id:
id).first</tt>)</p>
</li><li>
<p><tt>Account#beneficiary=(beneficiary)</tt> (similar to
<tt>beneficiary.account_id = account.id; beneficiary.save</tt>)</p>
</li><li>
<p><tt>Account#build_beneficiary</tt> (similar to
<tt>Beneficiary.new(&quot;account_id&quot; =&gt; id)</tt>)</p>
</li><li>
<p><tt>Account#create_beneficiary</tt> (similar to <tt>b =
Beneficiary.new(&quot;account_id&quot; =&gt; id); b.save; b</tt>)</p>
</li><li>
<p><tt>Account#create_beneficiary!</tt> (similar to <tt>b =
Beneficiary.new(&quot;account_id&quot; =&gt; id); b.save!; b</tt>)</p>
</li></ul>

<h3>Options</h3>

<p>The declaration can also include an options hash to specialize the behavior
of the association.</p>

<p>Options are:</p>
<dl class="rdoc-list"><dt>:class_name</dt>
<dd>
<p>Specify the class name of the association. Use it only if that name can’t
be inferred from the association name. So <tt>has_one :manager</tt> will by
default be linked to the Manager class, but if the real class name is
Person, you’ll have to specify it with this option.</p>
</dd><dt>:dependent</dt>
<dd>
<p>Controls what happens to the associated object when its owner is destroyed:</p>
<ul><li>
<p><tt>:destroy</tt> causes the associated object to also be destroyed</p>
</li><li>
<p><tt>:delete</tt> causes the associated object to be deleted directly from
the database (so callbacks will not execute)</p>
</li><li>
<p><tt>:nullify</tt> causes the foreign key to be set to <tt>NULL</tt>. <a
href="../Callbacks.html">Callbacks</a> are not executed.</p>
</li><li>
<p><tt>:restrict_with_exception</tt> causes an exception to be raised if there
is an associated record</p>
</li><li>
<p><tt>:restrict_with_error</tt> causes an error to be added to the owner if
there is an associated object</p>
</li></ul>
</dd><dt>:foreign_key</dt>
<dd>
<p>Specify the foreign key used for the association. By default this is
guessed to be the name of this class in lower-case and “_id” suffixed. So a
Person class that makes a <tt>has_one</tt> association will use “person_id”
as the default <tt>:foreign_key</tt>.</p>
</dd><dt>:primary_key</dt>
<dd>
<p>Specify the method that returns the primary key used for the association.
By default this is <tt>id</tt>.</p>
</dd><dt>:as</dt>
<dd>
<p>Specifies a polymorphic interface (See <tt>belongs_to</tt>).</p>
</dd><dt>:through</dt>
<dd>
<p>Specifies a Join Model through which to perform the query. Options for
<tt>:class_name</tt>, <tt>:primary_key</tt>, and <tt>:foreign_key</tt> are
ignored, as the association uses the source reflection. You can only use a
<tt>:through</tt> query through a <tt>has_one</tt> or <tt>belongs_to</tt>
association on the join model.</p>
</dd><dt>:source</dt>
<dd>
<p>Specifies the source association name used by <tt>has_one :through</tt>
queries. Only use it if the name cannot be inferred from the association.
<tt>has_one :favorite, through: :favorites</tt> will look for a
<tt>:favorite</tt> on Favorite, unless a <tt>:source</tt> is given.</p>
</dd><dt>:source_type</dt>
<dd>
<p>Specifies type of the source association used by <tt>has_one :through</tt>
queries where the source association is a polymorphic <tt>belongs_to</tt>.</p>
</dd><dt>:validate</dt>
<dd>
<p>If <tt>false</tt>, don’t validate the associated object when saving the
parent object. <tt>false</tt> by default.</p>
</dd><dt>:autosave</dt>
<dd>
<p>If true, always save the associated object or destroy it if marked for
destruction, when saving the parent object. If false, never save or destroy
the associated object. By default, only save the associated object if it’s
a new record.</p>

<p>Note that <tt>accepts_nested_attributes_for</tt> sets <tt>:autosave</tt> to
<tt>true</tt>.</p>
</dd><dt>:inverse_of</dt>
<dd>
<p>Specifies the name of the <tt>belongs_to</tt> association on the associated
object that is the inverse of this <tt>has_one</tt> association. Does not
work in combination with <tt>:through</tt> or <tt>:as</tt> options. See
ActiveRecord::Associations::ClassMethods’s overview on Bi-directional
associations for more detail.</p>
</dd></dl>

<p>Option examples:</p>

<pre>has_one :credit_card, dependent: :destroy  # destroys the associated credit card
has_one :credit_card, dependent: :nullify  # updates the associated records foreign
                                              # key value to NULL rather than destroying it
has_one :last_comment, -&gt; { order 'posted_on' }, class_name: &quot;Comment&quot;
has_one :project_manager, -&gt; { where role: 'project_manager' }, class_name: &quot;Person&quot;
has_one :attachment, as: :attachable
has_one :boss, readonly: :true
has_one :club, through: :membership
has_one :primary_address, -&gt; { where primary: true }, through: :addressables, source: :addressable</pre>
            

            
            <div class="method-source-code" id="has_one-source">
<pre>
<span class="ruby-comment"># File lib/active_record/associations.rb, line 1288</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_one</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">HasOne</span>.<span class="ruby-identifier">build</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- has_one-source -->
            
          </div>

          

          
        </div><!-- has_one-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

