<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: ThreadSafe::Util::Adder</title>

  <link rel="stylesheet" href="../../rdoc.css" type="text/css" media="screen" />

  <script src="../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../lib/thread_safe/util/adder_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/thread_safe/util/adder.rb">lib/thread_safe/util/adder.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="Striped64.html">ThreadSafe::Util::Striped64</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-i-add">#add</a></li>
          
          <li><a href="#method-i-decrement">#decrement</a></li>
          
          <li><a href="#method-i-increment">#increment</a></li>
          
          <li><a href="#method-i-reset">#reset</a></li>
          
          <li><a href="#method-i-sum">#sum</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../ThreadSafe.html">ThreadSafe</a></li>
        
          <li><a href="../../ThreadSafe/Array.html">ThreadSafe::Array</a></li>
        
          <li><a href="../../ThreadSafe/AtomicReferenceCacheBackend.html">ThreadSafe::AtomicReferenceCacheBackend</a></li>
        
          <li><a href="../../ThreadSafe/AtomicReferenceCacheBackend/Node.html">ThreadSafe::AtomicReferenceCacheBackend::Node</a></li>
        
          <li><a href="../../ThreadSafe/AtomicReferenceCacheBackend/Table.html">ThreadSafe::AtomicReferenceCacheBackend::Table</a></li>
        
          <li><a href="../../ThreadSafe/Cache.html">ThreadSafe::Cache</a></li>
        
          <li><a href="../../ThreadSafe/Hash.html">ThreadSafe::Hash</a></li>
        
          <li><a href="../../ThreadSafe/MriCacheBackend.html">ThreadSafe::MriCacheBackend</a></li>
        
          <li><a href="../../ThreadSafe/NonConcurrentCacheBackend.html">ThreadSafe::NonConcurrentCacheBackend</a></li>
        
          <li><a href="../../ThreadSafe/SynchronizedCacheBackend.html">ThreadSafe::SynchronizedCacheBackend</a></li>
        
          <li><a href="../../ThreadSafe/Util.html">ThreadSafe::Util</a></li>
        
          <li><a href="../../ThreadSafe/Util/Adder.html">ThreadSafe::Util::Adder</a></li>
        
          <li><a href="../../ThreadSafe/Util/CheapLockable.html">ThreadSafe::Util::CheapLockable</a></li>
        
          <li><a href="../../ThreadSafe/Util/PowerOfTwoTuple.html">ThreadSafe::Util::PowerOfTwoTuple</a></li>
        
          <li><a href="../../ThreadSafe/Util/Striped64.html">ThreadSafe::Util::Striped64</a></li>
        
          <li><a href="../../ThreadSafe/Util/Striped64/Cell.html">ThreadSafe::Util::Striped64::Cell</a></li>
        
          <li><a href="../../ThreadSafe/Util/Volatile.html">ThreadSafe::Util::Volatile</a></li>
        
          <li><a href="../../ThreadSafe/Util/VolatileTuple.html">ThreadSafe::Util::VolatileTuple</a></li>
        
          <li><a href="../../ThreadSafe/Util/XorShiftRandom.html">ThreadSafe::Util::XorShiftRandom</a></li>
        
          <li><a href="../../SynchronizedDelegator.html">SynchronizedDelegator</a></li>
        
          <li><a href="../../Threadsafe.html">Threadsafe</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">ThreadSafe::Util::Adder</h1>

    <div id="description" class="description">
      
<p>A Ruby port of the Doug Leaâ€™s jsr166e.LondAdder class version 1.8 available
in public domain. Original source code available here: <a
href="http://gee.cs.oswego.edu/cgi-bin/viewcvs.cgi/jsr166/src/jsr166e/LongAdder.java?revision=1.8">gee.cs.oswego.edu/cgi-bin/viewcvs.cgi/jsr166/src/jsr166e/LongAdder.java?revision=1.8</a></p>

<p>One or more variables that together maintain an initially zero sum. When
updates (method <tt>add</tt>) are contended across threads, the set of
variables may grow dynamically to reduce contention. Method <tt>sum</tt>
returns the current total combined across the variables maintaining the
sum.</p>

<p>This class is usually preferable to single <tt>Atomic</tt> reference when
multiple threads update a common sum that is used for purposes such as
collecting statistics, not for fine-grained synchronization control.  Under
low update contention, the two classes have similar characteristics. But
under high contention, expected throughput of this class is significantly
higher, at the expense of higher space consumption.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="add-method" class="method-detail ">
          <a name="method-i-add"></a>

          
          <div class="method-heading">
            <span class="method-name">add</span><span
              class="method-args">(x)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Adds the given value.</p>
            

            
            <div class="method-source-code" id="add-source">
<pre>
<span class="ruby-comment"># File lib/thread_safe/util/adder.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">x</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">current_cells</span> = <span class="ruby-identifier">cells</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cas_base_computed</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">current_base</span><span class="ruby-operator">|</span> <span class="ruby-identifier">current_base</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span>}
    <span class="ruby-identifier">was_uncontended</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">hash</span>            = <span class="ruby-identifier">hash_code</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">current_cells</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cell</span> = <span class="ruby-identifier">current_cells</span>.<span class="ruby-identifier">volatile_get_by_hash</span>(<span class="ruby-identifier">hash</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">was_uncontended</span> = <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">cas_computed</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">current_value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">current_value</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span>})
      <span class="ruby-identifier">retry_update</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">hash</span>, <span class="ruby-identifier">was_uncontended</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">current_value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">current_value</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- add-source -->
            
          </div>

          

          
        </div><!-- add-method -->

      
        <div id="decrement-method" class="method-detail ">
          <a name="method-i-decrement"></a>

          
          <div class="method-heading">
            <span class="method-name">decrement</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="decrement-source">
<pre>
<span class="ruby-comment"># File lib/thread_safe/util/adder.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">decrement</span>
  <span class="ruby-identifier">add</span>(<span class="ruby-value">-1</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- decrement-source -->
            
          </div>

          

          
        </div><!-- decrement-method -->

      
        <div id="increment-method" class="method-detail ">
          <a name="method-i-increment"></a>

          
          <div class="method-heading">
            <span class="method-name">increment</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="increment-source">
<pre>
<span class="ruby-comment"># File lib/thread_safe/util/adder.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">increment</span>
  <span class="ruby-identifier">add</span>(<span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- increment-source -->
            
          </div>

          

          
        </div><!-- increment-method -->

      
        <div id="reset-method" class="method-detail ">
          <a name="method-i-reset"></a>

          
          <div class="method-heading">
            <span class="method-name">reset</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="reset-source">
<pre>
<span class="ruby-comment"># File lib/thread_safe/util/adder.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset</span>
  <span class="ruby-identifier">internal_reset</span>(<span class="ruby-value">0</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- reset-source -->
            
          </div>

          

          
        </div><!-- reset-method -->

      
        <div id="sum-method" class="method-detail ">
          <a name="method-i-sum"></a>

          
          <div class="method-heading">
            <span class="method-name">sum</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns the current sum.  The returned value is <em>NOT</em> an atomic
snapshot: Invocation in the absence of concurrent updates returns an
accurate result, but concurrent updates that occur while the sum is being
calculated might not be incorporated.</p>
            

            
            <div class="method-source-code" id="sum-source">
<pre>
<span class="ruby-comment"># File lib/thread_safe/util/adder.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sum</span>
  <span class="ruby-identifier">x</span> = <span class="ruby-identifier">base</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_cells</span> = <span class="ruby-identifier">cells</span>
    <span class="ruby-identifier">current_cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">x</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cell</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">x</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- sum-source -->
            
          </div>

          

          
        </div><!-- sum-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

